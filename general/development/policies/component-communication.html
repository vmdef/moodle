<!doctype html>
<html lang="en-AU" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-general docs-doc-id-development/policies/component-communication/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L9EE8RW5B1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L9EE8RW5B1",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Moodle Developer Resources" href="/devdocs/opensearch.xml">


<link rel="icon" href="/devdocs/img/icons/orange_m.svg">
<link rel="manifest" href="/devdocs/manifest.json">
<meta name="theme-color" content="rgb(208, 99, 0)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/devdocs/img/icons/maskable_icon.png">
<link rel="mask-icon" href="/devdocs/img/icons/maskable_icon.png" color="rgb(208, 99, 0)">
<meta name="msapplication-TileImage" content="/devdocs/img/icons/maskable_icon.png">
<meta name="msapplication-TileColor" content="#000"><title data-rh="true">Component Communication | Moodle Developer Resources</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://moodledev.io/devdocs/general/development/policies/component-communication"><meta data-rh="true" name="docusaurus_locale" content="en-AU"><meta data-rh="true" name="docsearch:language" content="en-AU"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-general-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-general-current"><meta data-rh="true" property="og:title" content="Component Communication | Moodle Developer Resources"><meta data-rh="true" name="description" content="The Moodle Coding Style guidelines"><meta data-rh="true" property="og:description" content="The Moodle Coding Style guidelines"><link data-rh="true" rel="icon" href="/devdocs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://moodledev.io/devdocs/general/development/policies/component-communication"><link data-rh="true" rel="alternate" href="https://moodledev.io/devdocs/general/development/policies/component-communication" hreflang="en-AU"><link data-rh="true" rel="alternate" href="https://moodledev.io/devdocs/general/development/policies/component-communication" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NNUY2D5GV2-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/devdocs/assets/css/styles.294a7229.css">
<link rel="preload" href="/devdocs/assets/js/runtime~main.108433aa.js" as="script">
<link rel="preload" href="/devdocs/assets/js/main.2dbacd86.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/devdocs/"><div class="navbar__logo"><img src="/devdocs/img/Moodle.svg" alt="Moodle Developer Resources" class="themedImage_ToTc themedImage--light_HNdA" height="35px" width="138px"><img src="/devdocs/img/Moodle.svg" alt="Moodle Developer Resources" class="themedImage_ToTc themedImage--dark_i4oU" height="35px" width="138px"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/devdocs/docs">Guides</a><a class="navbar__item navbar__link" href="/devdocs/general/community/contribute">Community</a><a class="navbar__item navbar__link" href="/devdocs/general/development/gettingstarted">Coding</a><a class="navbar__item navbar__link" href="/devdocs/general/development/process">Process</a></div><div class="navbar__items navbar__items--right"><div class="wrapper_Jz6K"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/devdocs/general/development/gettingstarted">Getting started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/devdocs/general/development/policies">Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/development/policies/accessibility">Accessibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/development/policies/backporting">Backporting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/devdocs/general/development/policies/codingstyle">Coding style</a><button aria-label="Toggle the collapsible sidebar category &#x27;Coding style&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/development/policies/codingstyle-moodleapp">Moodle App Coding style</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/devdocs/general/development/policies/component-communication">Component Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/development/policies/deprecation">Deprecation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/development/policies/designing-usable-forms">Designing usable forms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/general/development/policies/naming">Naming conventions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/devdocs/general/development/policies/security">Security</a><button aria-label="Toggle the collapsible sidebar category &#x27;Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/devdocs/general/development/tools">Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/devdocs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/devdocs/general/development/policies"><span itemprop="name">Policies</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Component Communication</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Component Communication</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a class="hash-link" href="#components" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="Components in Moodle" src="/devdocs/assets/images/componentsinmoodle-1b1a260c55a95a2636ffa703bfd9f450.png" width="601" height="410" class="img_ev3q"></p><p>Moodle is code is split into different sections called <code>components</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="core">Core<a class="hash-link" href="#core" title="Direct link to heading">​</a></h3><p>The core libraries provide the base functionality that all other parts of moodle rely on. The component for core libraries is just referred to as <code>core</code>. Core code is not optional and cannot be safely removed without breaking Moodle. This means that it is always available and can be safely called from anywhere. Core code sits directly in the <code>/lib/</code> folder, or in the <code>/lib/classes/</code> folder for autoloaded core classes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subsystems">Subsystems<a class="hash-link" href="#subsystems" title="Direct link to heading">​</a></h3><p>Subsystems are groups of related functions and classes that are part of core, but are logically grouped together. Often they are tied to a particular feature in Moodle, and sometimes can be disabled/enabled via a single config setting - but the code is never removed. It is safe to call core subsystems from anywhere in Moodle - but the functions may return an error to indicate that a feature has been disabled. Each core subsystem has a defined location where its code is grouped together. As of Moodle 3.1 there are 66 subsystems in core and the comprehensive list can be found here:</p><p>core_component::fetch_subsystems()</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugins">Plugins<a class="hash-link" href="#plugins" title="Direct link to heading">​</a></h3><p>Plugins are optional components in Moodle that extend its functionality. M in Moodle stands for <code>Modular</code> and most of the code in Moodle belongs to plugins. There are many different types of plugins, and each plugin type supports a different way to extend core functionality. Information on the available plugins types in Moodle can be found here:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-types">Plugin Types<a class="hash-link" href="#plugin-types" title="Direct link to heading">​</a></h3><p>Vanilla Moodle package contains over 370 plugins. Additional plugins can be downloaded from the Plugins directory, or installed manually - and all plugins in Moodle are considered <code>optional</code>, even the ones included in vanilla package. This means that you can never assume a particular plugin will always exist on every Moodle site.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sub-plugins">Sub-plugins<a class="hash-link" href="#sub-plugins" title="Direct link to heading">​</a></h3><p>Some plugin types in Moodle support sub-plugins. This means that they can use other plugins to extend their own functionality. The only plugin types in Moodle that allow this are activity modules, editors, administration tools and local plugins. A sub-plugin can assume that its parent plugin is installed and does exist in Moodle - and can call its code directly, but it cannot assume anything about any other plugin or sub-plugin in Moodle.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a class="hash-link" href="#dependencies" title="Direct link to heading">​</a></h3><p>Some plugins in Moodle depend on other plugins. An example of a dependency relationship is a plugin that <code>hosts</code> sub-plugins - each of the sub-plugins depends on the parent. Another example is where the dependency is explicitly defined in the version.php of the plugin.</p><p><img loading="lazy" alt="Component dependencies" src="/devdocs/assets/images/componentdependencies-07e6506c3efe608b3b05a31467e4ab22.png" width="601" height="410" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="communication-channels">Communication Channels<a class="hash-link" href="#communication-channels" title="Direct link to heading">​</a></h2><p>There are different ways to call code in Moodle. Most of them are listed here and described in detail later on:</p><ul><li>Direct php function calls</li><li>External functions</li><li>JavaScript Modules (AMD)</li><li>Templates</li><li>get_string calls</li><li>Event observers</li><li>Component callbacks</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-rules-for-inter-component-communications">General rules for inter-component communications<a class="hash-link" href="#general-rules-for-inter-component-communications" title="Direct link to heading">​</a></h2><p>Because all plugins are optional, we can never rely on a plugin being installed in Moodle, unless there is a dependency relationship between the current component and the plugin. Core components and subsystems are always installed.
This means there are some strict rules about which types of communication are allowed in Moodle.</p><ul><li>It is always allowed to communicate with a <code>required</code> component. This includes core and all its subsystems.</li><li>Any component is allowed to communicate with itself.</li><li>It is allowed to communicate with another component if the calling component <code>depends</code> on the other component (see description of dependencies above).</li><li>Not shown in the diagram - but the same rules apply to sub-plugins. They can communicate with their parent and any plugin that they explicitly (version.php) depend on.</li><li>All other inter-component communications are forbidden.</li></ul><p><img loading="lazy" alt="Allowed communication" src="/devdocs/assets/images/allowedcommunication-a18a08cc8737b318a5f1d88374255639.png" width="601" height="491" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="direct-php-function-calls">Direct php function calls<a class="hash-link" href="#direct-php-function-calls" title="Direct link to heading">​</a></h3><p>This is the simplest type of communication - you know the name of a function so you just call it. Sometimes the name of the function is generated from the component name to allow different plugins to implement the same function with a different prefix or namespace.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="external-functions">External functions<a class="hash-link" href="#external-functions" title="Direct link to heading">​</a></h3><p>External functions are functions defined in Moodle using the External API. These are functions suitable to call from webservices, or call directly from other parts of Moodle. Each external function follows a similar pattern:</p><ul><li>Parse and validate arguments</li><li>Perform security checks and setup the theme and language (from the context)</li><li>Call an internal API</li><li>Return and validate the response</li></ul><p>Calling external functions from another component in Moodle is no different to calling the php functions directly. This is allowed and encouraged.</p><p>One thing to think about when calling external functions from php though is that they are designed to be able to be called from a webservice, and so they will re-do all of the security checks and setup of the page theme and language that you have probably already done in your php page. To make sure this doesn&#x27;t cause side-effects (like changing the theme halfway through a page), always use the wrapper in <code>external_api::call_external_function()</code> instead of calling the external function directly.</p><p>Additional rules for calling external functions:</p><ul><li>Always use the <code>external_api::call_external_function()</code> wrapper when calling from php.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="javascript-modules-amd">JavaScript Modules (AMD)<a class="hash-link" href="#javascript-modules-amd" title="Direct link to heading">​</a></h3><p>It is possible through the JavaScript loader to load an AMD module from any component and call its functions. This is a form of inter-component communication and must obey the strict rules for which components AMD modules can be loaded from.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="get_string">get_string<a class="hash-link" href="#get_string" title="Direct link to heading">​</a></h3><p>It is possible to fetch strings from any component in Moodle. This is a form of inter-component communication and and must obey the strict rules for which components strings can be fetched from.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="templates-mustache">Templates (Mustache)<a class="hash-link" href="#templates-mustache" title="Direct link to heading">​</a></h3><p>It is possible to fetch templates from any component in Moodle. This is a form of inter-component communication and and must obey the strict rules for which components templates can be fetched from.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-observers">Event observers<a class="hash-link" href="#event-observers" title="Direct link to heading">​</a></h3><p>Any action in Moodle can trigger one or more <code>events</code>.</p><p>In Moodle it is possible to register observers for events. An observer is notified when an event happens and receives the data related to that event. An observer can only act on the information in the event. It cannot modify the data for the event or prevent the action from occurring. The component containing the observer is communicating with the component that declared the event class. The normal rules for inter-component communication apply.</p><p>In addition - event observers are a form of execution at a distance. It would be extremely difficult to read and maintain code heavily relying on event observers (especially if the observers perform actions that trigger more events).</p><p>Additional rules for event observers:</p><ul><li>Events are not allowed to be observed by core or a core subsystem (there are some currently wrong observers in core that should be removed).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="callback-methods-component_callback-get_plugins_with_function">Callback methods (component_callback, get_plugins_with_function…)<a class="hash-link" href="#callback-methods-component_callback-get_plugins_with_function" title="Direct link to heading">​</a></h3><p>The most common way (but not the only way) to implement a callback is using the <code>component_callback()</code> function. This function works by looping over the installed plugins and calling a function from each plugin based on appending the component name to the supplied function name. It then expects the function to be defined either in the plugins lib.php file, or in an autoloaded location (but not in a class!).</p><p><a href="https://docs.moodle.org/dev/Callbacks" target="_blank" rel="noopener noreferrer">List of callbacks in Moodle</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a class="hash-link" href="#faq" title="Direct link to heading">​</a></h2><p><strong>Q: So how does plugin X call a function from plugin Y if they don&#x27;t depend on each other?</strong></p><p>A: By communicating through a core API.</p><p><strong>Q: What? Really?</strong></p><p>A: Anytime one plugin wants to communicate to one other specific plugin - it&#x27;s better to create a core API and channel all communication through that API. For example <code>assignment online text</code> uses the <code>Editor API</code> to add a rich text field to the form. It does not directly add an instance of <code>Atto</code> to the form. This allows either plugin to be replaced by a different, (hopefully better) plugin without changing the API or the other plugin. Remember, any plugin in Moodle is optional and may be removed in the future.</p><p><strong>Q: How do I know if there is an API I can already use?</strong></p><p>A: Existing callbacks are listed <a href="https://docs.moodle.org/dev/Callbacks" target="_blank" rel="noopener noreferrer">here</a>, major core APIs are listed <a href="/devdocs/docs/apis">here</a>.</p><p><strong>Q: Can I change the data provided to a component_callback and maintain backwards compatibility.</strong></p><p>A: No it is not possible. You must implement a second callback with a new name.</p><p><strong>Q: Can I control the order in which plugins callbacks are executed?</strong></p><p>A: No it is not possible.</p><p><strong>Q: Can I find all the plugins implementing a callback?</strong></p><p>A: You can grep the code or create a test script that executes <code>get_plugins_with_function()</code></p><p><strong>Q: How can I ensure the name for my new callback is unique?</strong></p><p>A: Check <a href="https://docs.moodle.org/dev/Callbacks" target="_blank" rel="noopener noreferrer">list of existing callbacks</a>. Consider prefixing with the component name the callback is defined in - but existing code does not do this much.</p><p><strong>Q: Will my callback function be called even if my plugin is disabled?</strong></p><p>A: Yes - you must manually check if your own plugin is disabled before responding to a component callback.</p><p><strong>Q: I looked, there is no existing API I can use. How do I get a new one added to core?</strong></p><p>A: Create a tracker issue, post a patch (with unit tests) and explain your use case.</p><p><strong>Q: When should I create a callback and when should I use event observers?</strong></p><p>A: Event observers should not be added to facilitate plugin communication. They are about notifying the system that a real event occurred. Use an event observer only if:</p><ul><li>There is a real event occurring at the point you need to execute some additional code.</li><li>You are not cheating the inter-component communication rules.</li><li>You do not need to modify any of the data related to the event.</li></ul><p>Otherwise add a new callback and execute for each plugin implementing it, using <code>get_plugins_with_function()</code></p><p><strong>Q: Can I use one of the broadcast functions to provide a callback to some plugin types, but not all of them?</strong></p><p>A: It is better to allow all plugin types. Previously assumptions have been made about which plugins should be able to respond to an API and they have almost always turned out wrong.</p><p><strong>Q: Can create an API with callbacks that supports multiple stages?</strong></p><p>A: Not easily. You must create a separate callback for each stage and hope that consumers of your API create the correct function for each stage. An alternative is to create a callback that is expected to be returned an instance of an abstract class which defines your API.</p><p><strong>Q: Global functions are bad. Can I implement a callback in a class instead?</strong></p><p>A: No. Sorry.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ideal-plugin-design">Ideal plugin design<a class="hash-link" href="#ideal-plugin-design" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="Ideal plugin design" src="/devdocs/assets/images/idealplugindesign-7f188504c3df902b91a2afdb01ae30d4.png" width="601" height="479" class="img_ev3q"></p><p>When building a new plugin for Moodle - it is good to think about how to best structure the code so that we separate our code into layers of functionality. This way we can provide a secure and comprehensive API that can be called from inside, or outside of our component, or from web-services (like the Mobile App or AJAX).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-api">Low Level API<a class="hash-link" href="#low-level-api" title="Direct link to heading">​</a></h3><p>In this model, the DB tables are accessed through a low level API that knows about all the types, relationships and validation rules for the data in the tables. No permission checking is done at this level for performance and complexity reasons.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="component-api">Component API<a class="hash-link" href="#component-api" title="Direct link to heading">​</a></h3><p>The component API defines all the things this plugin can do. Every function in the API should perform permission checks and validation on the parameters and return types and be covered by unit tests. This is the useful API that can be used by pages in your plugin, or called directly by another component in Moodle (only if it depends on this plugin).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="external-api">External API<a class="hash-link" href="#external-api" title="Direct link to heading">​</a></h3><p>The external API is a single class that wraps each function in the Component API. By exposing all the functions in the Component API we allow people to build new interfaces and apps that we have never even thought about without requiring changes to our plugin. Covering each external function with a unit test ensures that all our parameters and return types are correctly specified. Note: External API functions can be called directly from other dependant plugins or sub-plugins in Moodle - but you must use the external_api::call_external_function to do so or you will introduce problems with theme, language and context.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="webservice-api">Webservice API<a class="hash-link" href="#webservice-api" title="Direct link to heading">​</a></h3><p>This is not really an API, it is just a listing of all the functions in the external API in our plugins db/services.php file. This allows all these functions to be called from AJAX or webservices clients like the Mobile App.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="editing-images-in-this-doc-page">Editing images in this doc page<a class="hash-link" href="#editing-images-in-this-doc-page" title="Direct link to heading">​</a></h2><p>This page was created from a google doc. To edit the images in this page - re-export them from the original document here: <a href="https://docs.google.com/document/d/1Z-vRWztT05bsb9b5KbBpLRP26oa3KTx3thB52_BW5VY/edit#heading=h.ardt51j6brj1" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1Z-vRWztT05bsb9b5KbBpLRP26oa3KTx3thB52_BW5VY/edit#heading=h.ardt51j6brj1</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/devdocs/general/tags/policies">Policies</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/devdocs/general/tags/coding-guidelines">Coding guidelines</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/moodle/devdocs/edit/main/general/development/policies/component-communication/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-06-17T11:03:23.000Z">17/06/2022</time></b> by <b>Andrew Lyons</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/devdocs/general/development/policies/codingstyle-moodleapp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Moodle App Coding style</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/devdocs/general/development/policies/deprecation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deprecation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#core" class="table-of-contents__link toc-highlight">Core</a></li><li><a href="#subsystems" class="table-of-contents__link toc-highlight">Subsystems</a></li><li><a href="#plugins" class="table-of-contents__link toc-highlight">Plugins</a></li><li><a href="#plugin-types" class="table-of-contents__link toc-highlight">Plugin Types</a></li><li><a href="#sub-plugins" class="table-of-contents__link toc-highlight">Sub-plugins</a></li><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li></ul></li><li><a href="#communication-channels" class="table-of-contents__link toc-highlight">Communication Channels</a></li><li><a href="#general-rules-for-inter-component-communications" class="table-of-contents__link toc-highlight">General rules for inter-component communications</a><ul><li><a href="#direct-php-function-calls" class="table-of-contents__link toc-highlight">Direct php function calls</a></li><li><a href="#external-functions" class="table-of-contents__link toc-highlight">External functions</a></li><li><a href="#javascript-modules-amd" class="table-of-contents__link toc-highlight">JavaScript Modules (AMD)</a></li><li><a href="#get_string" class="table-of-contents__link toc-highlight">get_string</a></li><li><a href="#templates-mustache" class="table-of-contents__link toc-highlight">Templates (Mustache)</a></li><li><a href="#event-observers" class="table-of-contents__link toc-highlight">Event observers</a></li><li><a href="#callback-methods-component_callback-get_plugins_with_function" class="table-of-contents__link toc-highlight">Callback methods (component_callback, get_plugins_with_function…)</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li><li><a href="#ideal-plugin-design" class="table-of-contents__link toc-highlight">Ideal plugin design</a><ul><li><a href="#low-level-api" class="table-of-contents__link toc-highlight">Low Level API</a></li><li><a href="#component-api" class="table-of-contents__link toc-highlight">Component API</a></li><li><a href="#external-api" class="table-of-contents__link toc-highlight">External API</a></li><li><a href="#webservice-api" class="table-of-contents__link toc-highlight">Webservice API</a></li></ul></li><li><a href="#editing-images-in-this-doc-page" class="table-of-contents__link toc-highlight">Editing images in this doc page</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Moodle</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/releases">Release notes</a></li><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/projects">Projects</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/documentation">Developer docs</a></li><li class="footer__item"><a href="https://docs.moodle.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">User docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.moodle.org/dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legacy docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/documentation/code-of-conduct">Code of conduct</a></li><li class="footer__item"><a href="https://moodle.org/mod/forum/view.php?id=55" target="_blank" rel="noopener noreferrer" class="footer__link-item">General Developer Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/moodle" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/moodle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                    <a href="https://www.netlify.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                        <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51">
                    </a>
                    </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
Copyright © 2022 Moodle Pty Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/devdocs/assets/js/runtime~main.108433aa.js"></script>
<script src="/devdocs/assets/js/main.2dbacd86.js"></script>
</body>
</html>