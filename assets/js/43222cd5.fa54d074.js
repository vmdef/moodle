(self.webpackChunkdevdocs=self.webpackChunkdevdocs||[]).push([[36105],{88698:function(e,t,n){"use strict";var a=n(75963);t.Z=void 0;var o=a(n(64938)),i=n(85893),r=(0,o.default)((0,i.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3 1 9l11 6 9-4.91V17h2V9L12 3z"}),"School");t.Z=r},85162:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(67294),o=n(86010),i="tabItem_Ymn6";function r(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(i,r),hidden:n},t)}},65488:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var a=n(83117),o=n(67294),i=n(86010),r=n(72389),l=n(67392),s=n(7094),d=n(12466),c="tabList__CuJ",u="tabItem_LNqP";function m(e){var t,n,r=e.lazy,m=e.block,p=e.defaultValue,h=e.values,v=e.groupId,g=e.className,f=o.Children.map(e.children,(function(e){if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=h?h:f.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),w=(0,l.l)(k,(function(e,t){return e.value===t.value}));if(w.length>0)throw new Error('Docusaurus error: Duplicate values "'+w.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var y=null===p?p:null!=(t=null!=p?p:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:f[0].props.value;if(null!==y&&!k.some((function(e){return e.value===y})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+y+'" but none of its children has the corresponding value. Available values are: '+k.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=(0,s.U)(),b=N.tabGroupChoices,M=N.setTabGroupChoices,S=(0,o.useState)(y),x=S[0],T=S[1],C=[],E=(0,d.o5)().blockElementScrollPositionUntilNextRender;if(null!=v){var _=b[v];null!=_&&_!==x&&k.some((function(e){return e.value===_}))&&T(_)}var P=function(e){var t=e.currentTarget,n=C.indexOf(t),a=k[n].value;a!==x&&(E(t),T(a),null!=v&&M(v,String(a)))},j=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a,o=C.indexOf(e.currentTarget)+1;n=null!=(a=C[o])?a:C[0];break;case"ArrowLeft":var i,r=C.indexOf(e.currentTarget)-1;n=null!=(i=C[r])?i:C[C.length-1]}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,i.Z)("tabs-container",c)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":m},g)},k.map((function(e){var t=e.value,n=e.label,r=e.attributes;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,key:t,ref:function(e){return C.push(e)},onKeyDown:j,onFocus:P,onClick:P},r,{className:(0,i.Z)("tabs__item",u,null==r?void 0:r.className,{"tabs__item--active":x===t})}),null!=n?n:t)}))),r?(0,o.cloneElement)(f.filter((function(e){return e.props.value===x}))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},f.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function p(e){var t=(0,r.Z)();return o.createElement(m,(0,a.Z)({key:String(t)},e))}},32798:function(e){e.exports={siteHome:"https://moodle.academy/",courses:{setup:{id:29,name:"Set up your Moodle Development Environment",summary:"Learn about the Moodle developer community and setting up a development environment",description:"This course is designed for PHP developers who want to start developing Moodle plugins. You will learn about the Moodle developer community and set up a Moodle development environment. This is the first course in the Developer Pathway. Subsequent courses in the the Developer Pathway will build on the knowledge gained in this course.",tags:["development","basics","setup"],archived:!1,series:[]},securityEssentials:{id:53,name:"Moodle Access and Security Essentials",summary:"A short course looking at access control and security aspects of plugins.",description:"In this course we look at access control and security aspects of a plugin. Through a set of tutorials, you will learn how to control access to your plugin using Moodle's Access API. You will learn how to define capabilities in your plugin and how to determine if the user has the permission to access a page. This course also covers common security threats that developers need to be aware of.\n\nThis is the fourth course in the Moodle Developer Basics program.",tags:["development","basic","essentials","security","api"],archived:!1,series:["basics"]},outputEssentials:{id:49,name:"Web Output Essentials",summary:"Learn how to use Moodle's Page and Output APIs to display content in a local plugin.",description:"This course builds on the knowledge gained in the Moodle development environment course. In this course, we learn how to use Moodle's Page and Output APIs to display content in a local plugin. An introduction to localisation using language strings is also covered in this course. This is the second course in the Moodle developer pathway.",tags:["development","basics","essentials","output","api"],archived:!1,series:["basics"]},architecture:{id:51,name:"Moodle's Modular Architecture and APIs",summary:"Take a deeper look at Moodle's architecture, exploring common APIs including Navigations, Forms, Database, Upgrade, Strings, and Output.",description:"In this course we take a deeper look at Moodle's modular architecture and explore the use of common Moodle APIs. Some of the APIs covered in this course include: Navigation, Forms, Database access, Upgrade, Strings and Output APIs. Learners get hands-on practise on using these APIs in the form of developing a local plugin.\n\nThis is the third course in the Moodle Developer Basics program.",tags:["development","api","architecture"],archived:!1,series:["basics"]},pluginBasics:{id:10,name:"Moodle Plugin Development Basics",summary:"Learn about the essential concepts in Moodle's moduel architecture.",description:"This course teaches you essential concepts related to Moodle's modular architecture, enabling you to develop a simple demo plugin.\n\nPlease note, this course is being migrated to form a new program of short courses on Moodle Academy (called 'Moodle Developer Basics'), which will all be available at the end of April 2022. For now you may still complete the course on Learn Moodle, or you might like to start the Moodle Academy developer short courses that are being released over the coming weeks and will form this new beginner level program.",tags:["development","basics","essentials","api","plugins","architecture"],archived:!1,series:["basics"]}}}},50793:function(e,t,n){"use strict";n.d(t,{dn:function(){return x.Z},vL:function(){return S},U6:function(){return N},E2:function(){return T.Z},mQ:function(){return C.Z},Zh:function(){return M}});n(86134);var a=n(67294),o=n(87918),i=n(80102),r=n(83117),l=n(95408),s=n(98700),d=n(39707),c=n(59766),u=n(69348),m=n(54502),p=n(85893);const h=["component","direction","spacing","divider","children"];function v(e,t){const n=a.Children.toArray(e).filter(Boolean);return n.reduce(((e,o,i)=>(e.push(o),i<n.length-1&&e.push(a.cloneElement(t,{key:`separator-${i}`})),e)),[])}const g=(0,u.ZP)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>[t.root]})((({ownerState:e,theme:t})=>{let n=(0,r.Z)({display:"flex"},(0,l.k9)({theme:t},(0,l.P$)({values:e.direction,breakpoints:t.breakpoints.values}),(e=>({flexDirection:e}))));if(e.spacing){const a=(0,s.hB)(t),o=Object.keys(t.breakpoints.values).reduce(((t,n)=>(null==e.spacing[n]&&null==e.direction[n]||(t[n]=!0),t)),{}),i=(0,l.P$)({values:e.direction,base:o}),r=(0,l.P$)({values:e.spacing,base:o}),d=(t,n)=>{return{"& > :not(style) + :not(style)":{margin:0,[`margin${o=n?i[n]:e.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[o]}`]:(0,s.NA)(a,t)}};var o};n=(0,c.Z)(n,(0,l.k9)({theme:t},r,d))}return n})),f=a.forwardRef((function(e,t){const n=(0,m.Z)({props:e,name:"MuiStack"}),a=(0,d.Z)(n),{component:o="div",direction:l="column",spacing:s=0,divider:c,children:u}=a,f=(0,i.Z)(a,h),k={direction:l,spacing:s};return(0,p.jsx)(g,(0,r.Z)({as:o,ownerState:k,ref:t},f,{children:c?v(u,c):u}))}));var k=f,w=n(39960);function y(e,t,n){var i=function(e){return"number"==typeof e&&Number.isInteger(e)?e.toFixed(1):e}(t),r=a.createElement("span",null,function(e){if("since"===e)return"Since";if("deprecated"===e)return"Deprecated";throw new Error("Unknown <Since> type: '"+e+"'")}(e)," ",i),l=a.createElement(o.Z,{key:"chip-"+e+i,label:r,clickable:!!n});return n?a.createElement(w.Z,{to:"https://tracker.moodle.org/browse/"+n,key:"link-"+e+i},l):l}function N(e){var t,n,o,i,r,l,s,d,c,u=(n=(t=e).issueNumber,o=void 0===n?null:n,i=t.type,r=void 0===i?"since":i,l=t.versions,s=void 0===l?[]:l,d=t.version,(c=void 0===d?null:d)?y(r,c,o):s.map((function(e){return y(r,e,o)})));return a.createElement(k,{direction:"row",justifyContent:"flex-end",spacing:2},u)}var b=n(86010);function M(e){return a.createElement("div",{className:(0,b.Z)(" alert alert--success margin-bottom--lg ")},a.createElement("span",{className:(0,b.Z)(" badge badge--success ")},"An example of correct behaviour"),e.children)}function S(e){return a.createElement("div",{className:(0,b.Z)(" alert alert--danger margin-bottom--lg ")},a.createElement("span",{className:(0,b.Z)(" badge badge--danger ")},"An example of incorrect behaviour"),e.children)}n(80069);var x=n(46975),T=n(85162),C=n(65488)},86134:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var a=n(67294),o=n(69119),i=n(39960),r=n(88698),l=n(32798),s=n.n(l),d=n(80684);function c(e){var t=e.courseName;if(!s().courses[t])throw Error("Unknown course "+t);var n=s().courses[t];return a.createElement(o.Z,{type:"info",icon:a.createElement(r.Z,{fontSize:"inherit"}),title:"Learn more on Moodle Academy"},"You can learn more about"," ",a.createElement("strong",null,e.subject)," ","from the"," ",a.createElement(d.Z,{title:n.summary},a.createElement(i.Z,{to:s().siteHome+"course/view.php?id="+n.id},n.name))," ","on Moodle Academy.")}},80069:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var a=n(67294),o=n(87918),i=n(80684),r=n(86886),l=n(34673),s=n(3905),d=function(e,t,n){return void 0===n&&(n="info"),a.createElement(r.ZP,{item:!0,key:e},a.createElement(i.Z,{title:t},a.createElement(o.Z,{label:e,color:n})))};function c(e){var t=e.filepath,n=e.summary,o=function(e){var t=e.required,n=void 0!==t&&t,a=e.legacy,o=void 0!==a&&a,i=e.deprecated,r=void 0!==i&&i,l=e.refreshedDuringUpgrade,s=void 0!==l&&l,c=e.refreshedDuringPurge,u=void 0!==c&&c,m=[];return s&&m.push(d("Upgradable","Changes to this file or directory will be re-applied during a Moodle upgrade. If you make any changes to it, you can simply increment the version number and perform a Moodle upgrade.","info")),u&&m.push(d("Refreshed on cache purge","The contents of this file or directory are cached. To see your changes you can simply purge Moodle's caches and refresh the page.","info")),n&&m.push(d("Required","This file must be present","success")),o&&m.push(d("Legacy","Use of this file is being phased out. It is still supported for older installations but will be removed..","warning")),r&&m.push(d("Deprecated","Use of this file is deprecated and not recommended.It may still be provided for older versions of Moodle but is no longer used.","error")),m}(e),i=e.description?a.createElement(r.ZP,{item:!0,xs:12},e.description):null;return a.createElement(s.Zo,null,a.createElement(r.ZP,{container:!0,spacing:2},a.createElement(r.ZP,{item:!0,xs:6},a.createElement("h4",null,n)),a.createElement(r.ZP,{item:!0,xs:6},a.createElement(r.ZP,{container:!0,spacing:2,justifyContent:"flex-end"},o)),a.createElement(r.ZP,{item:!0,xs:12},a.createElement("h5",null,"File path:"," ",t)),i,function(e){var t=e.example,n=e.open,o=void 0!==n&&n;return t?a.createElement(r.ZP,{item:!0,xs:12},a.createElement(l.Z,{summary:a.createElement("summary",null,"View example"),open:o},t)):null}(e)))}},41698:function(e,t,n){"use strict";n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return c},default:function(){return v},frontMatter:function(){return d},metadata:function(){return u},toc:function(){return p}});var a=n(83117),o=n(80102),i=(n(67294),n(3905)),r=n(13904),l=n(50793),s=["components"],d={title:"JavaScript"},c=void 0,u={unversionedId:"guides/javascript/index",id:"guides/javascript/index",title:"JavaScript",description:"Moodle makes heavy use of JavaScript to improve the experience for its users.",source:"@site/docs/guides/javascript/index.md",sourceDirName:"guides/javascript",slug:"/guides/javascript/",permalink:"/devdocs/docs/guides/javascript/",draft:!1,editUrl:"https://github.com/moodle/devdocs/edit/main/docs/guides/javascript/index.md",tags:[],version:"current",lastUpdatedBy:"Andrew Lyons",lastUpdatedAt:1655463803,formattedLastUpdatedAt:"17/06/2022",frontMatter:{title:"JavaScript"},sidebar:"docs",previous:{title:"Developer guides",permalink:"/devdocs/docs/guides"},next:{title:"Creating a reactive UI",permalink:"/devdocs/docs/guides/javascript/reactive/"}},m={},p=[{value:"Useful References",id:"useful-references",level:2},{value:"Modules",id:"modules",level:2},{value:"Writing your first module",id:"writing-your-first-module",level:2},{value:"Listen to a DOM Event",id:"listen-to-a-dom-event",level:3},{value:"Including JavaScript from your pages",id:"including-javascript-from-your-pages",level:2},{value:"Including from a template",id:"including-from-a-template",level:3},{value:"Including from PHP",id:"including-from-php",level:3},{value:"Passing data to your Module",id:"passing-data-to-your-module",level:2},{value:"Using data attributes",id:"using-data-attributes",level:3},{value:"Promises",id:"promises",level:2},{value:"Examples",id:"examples",level:3},{value:"Working with Strings",id:"working-with-strings",level:2},{value:"Templates",id:"templates",level:2},{value:"Modals",id:"modals",level:2},{value:"Notifications",id:"notifications",level:2},{value:"AJAX Calls",id:"ajax-calls",level:2},{value:"Preferences",id:"preferences",level:2},{value:"Prefetch",id:"prefetch",level:2},{value:"Reactive state",id:"reactive-state",level:2},{value:"Tools",id:"tools",level:2},{value:"Grunt",id:"grunt",level:3},{value:"Installing grunt",id:"installing-grunt",level:4},{value:"Using grunt",id:"using-grunt",level:4},{value:"ESLint",id:"eslint",level:3}],h={toc:p};function v(e){var t=e.components,n=(0,o.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)(r.Z,(0,a.Z)({frontMatter:d},void 0!==u?{metadata:u}:{},{mdxType:"MoodlePageBanner"})),(0,i.kt)("p",null,"Moodle makes heavy use of JavaScript to improve the experience for its users."),(0,i.kt)("p",null,"All new JavaScript in Moodle should use the ES2015+ module format, which is\ntranspiled into the CommonJS format.\nModules are loaded in the browser using the RequireJS loader."),(0,i.kt)("p",null,"All Moodle JavaScript can use the same Mustache templates and translated strings which are available to Moodle PHP code, and the standard Moodle web service framework can be used to fetch and store data."),(0,i.kt)("p",null,"This guide covers how to get started with JavaScript in Moodle, and introduces key concepts and features including module format and structure, including your code, using templates, using translation features, tooling, and handling events."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You may see the terms ",(0,i.kt)("inlineCode",{parentName:"p"},"ES6")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"ES2015")," used interchangeably.\nES2015 is the 6th generation of the Ecma Script specification.\nES2015 represents a big change from previous versions of the Ecma Script\nspecification."))),(0,i.kt)("h2",{id:"useful-references"},"Useful References"),(0,i.kt)("p",null,"Moodle uses vanilla JavaScript combined with helpers for performing common actions, and a small collection of libraries\nfor serving and managing dependencies."),(0,i.kt)("p",null,"The JavaScript documentation available on the Mozilla Developer Network is one of the best reference documentations\navailable. You may find the following references particularly useful:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript"},"MDN JavaScript guide"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference"},"MDN JavaScript Reference"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://devhints.io/es6"},"ES2015+ Cheat-sheet"))),(0,i.kt)("h2",{id:"modules"},"Modules"),(0,i.kt)("p",null,"JavaScript in Moodle is structured into ES2015 modules which are transpiled into the CommonJS format."),(0,i.kt)("p",null,"Like our PHP classes and Mustache templates, our JavaScript modules each belong to a particular {term}",(0,i.kt)("inlineCode",{parentName:"p"},"component"),"\nand must be named according to our standard ",(0,i.kt)("a",{parentName:"p",href:"/general/development/policies/naming#javascript"},"name and namespace conventions"),"."),(0,i.kt)("p",null,"The naming scheme for Moodle's JavaScript fits into the pattern:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"[component_name]/[optional/sub/namespace/][modulename]")),(0,i.kt)("p",null,"The first directory in any subfolder must be either a Moodle API, or ",(0,i.kt)("inlineCode",{parentName:"p"},"local"),"."),(0,i.kt)("p",null,"The following are examples of valid module names:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"// For a module named `discussion` in the `mod_forum` component:\nmod_forum/discussion\n\n// For a module named `grader` in the `mod_assign` component which is\n// part of the `grades` API:\nmod_assign/grades/grader\n\n// For a module named `confirmation` in the `block_newsitems` component\n// which is a modal and not part of a core API:\nblock_newsitems/local/modal/confirmation\n\n// For a module name `selectors` in the `core_user` component and relates\n// to the `participants` module:\ncore_user/local/participants/selectors\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"When structuring a new module you may find it clearer to create a main entry-point module with related modules stored in\na subdirectory."),(0,i.kt)("p",{parentName:"div"},"For example when creating a new module which controls interactions on the Participants page and which is part of\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"core_user")," component you will create a ",(0,i.kt)("inlineCode",{parentName:"p"},"participants")," module.\nThe full namespace for this module will be ",(0,i.kt)("inlineCode",{parentName:"p"},"core_user/participants"),"."),(0,i.kt)("p",{parentName:"div"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"core_user/participants")," module may interact with DOM elements which are identified by CSS Selectors.\nThe Moodle convention is to place the selectors in a ",(0,i.kt)("inlineCode",{parentName:"p"},"selectors")," module."),(0,i.kt)("p",{parentName:"div"},"The module will also call a set of Web Services.\nThe Moodle convention is to place calls to Web Services in a ",(0,i.kt)("inlineCode",{parentName:"p"},"repository")," module."),(0,i.kt)("p",{parentName:"div"},"Since ",(0,i.kt)("inlineCode",{parentName:"p"},"participants")," isn't a formal API in Moodle you must create your submodules in the ",(0,i.kt)("inlineCode",{parentName:"p"},"local/participants"),"\ndirectory."),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-console"},".\n\u251c\u2500\u2500 local\n\u2502\xa0\xa0 \u2514\u2500\u2500 participants\n\u2502\xa0\xa0     \u251c\u2500\u2500 repository.js       // core_user/local/participants/selectors\n\u2502\xa0\xa0     \u2514\u2500\u2500 selectors.js        // core_user/local/participants/repository\n\u2514\u2500\u2500 participants.js             // core_user/participants\n")))),(0,i.kt)("h2",{id:"writing-your-first-module"},"Writing your first module"),(0,i.kt)("p",null,"The convention in Moodle is to have one JavaScript Module which is your initial entrypoint.\nThis usually provides a function called ",(0,i.kt)("inlineCode",{parentName:"p"},"init")," which you then ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export"},"export")," from the module.\nThis ",(0,i.kt)("inlineCode",{parentName:"p"},"init")," function will be called by Moodle."),(0,i.kt)("p",null,"Your module will probably also have one or more dependencies which you will ",(0,i.kt)("inlineCode",{parentName:"p"},"import"),"."),(0,i.kt)("p",null,"As you start to build out the structure of your code you will start to export more functions, as well as Objects,\nClasses, and other data structures."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This guide isn't intended to teach you how to write JavaScript.\nIf you are new to JavaScript, you may want to start with the ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web"},"MDN JavaScript\nbasics guide"),"."))),(0,i.kt)("p",null,"A module which calls to the browser ",(0,i.kt)("inlineCode",{parentName:"p"},"console.log")," function would look like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',title:'"mod/example/lib/amd/src/helloworld.js"'},"export const init = () => {\n    window.console.log('Hello, world!');\n};\n")),(0,i.kt)("p",null,"In this example a new variable called ",(0,i.kt)("inlineCode",{parentName:"p"},"init")," is created and exported using\nthe ES2015 ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export"},"export")," keyword.\nThe variable is assigned an arrow function expression which takes no\narguments, and when executed will call the browser ",(0,i.kt)("inlineCode",{parentName:"p"},"console.log")," function\nwith the text ",(0,i.kt)("inlineCode",{parentName:"p"},'"Hello, world!"'),"."),(0,i.kt)("h3",{id:"listen-to-a-dom-event"},"Listen to a DOM Event"),(0,i.kt)("p",null,"Usually you will want to perform an action in response to a user\ninteracting with the page."),(0,i.kt)("p",null,"You can use the ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener"},"document.addEventListener()")," method to do\nthis."),(0,i.kt)("p",null,"To add a ",(0,i.kt)("inlineCode",{parentName:"p"},"click")," listener to the entire body you would write:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',title:'"mod/example/lib/amd/src/helloworld.js"'},"export const init = () => {\n    document.addEventListener('click', e => {\n        window.console.log(e.target);\n    });\n};\n")),(0,i.kt)("p",null,"In this example any time that a user clicks anywhere on the document the item\nthat was clicked on will be logged to the browser console."),(0,i.kt)("p",null,"Usually you won't want to listen for every click in the document but only for\nsome Elements in the page."),(0,i.kt)("p",null,"If you wanted to display a browser alert every time a user clicks on a button,\nyou might have a template like the following example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-handlebars",metastring:'title="mod/example/templates/helloworld.mustache"',title:'"mod/example/templates/helloworld.mustache"'},' <button data-action="mod_example/helloworld-update_button">Click me</button>\n')),(0,i.kt)("p",null,"You can write a listener which looks for clicks to this button:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',title:'"mod/example/lib/amd/src/helloworld.js"'},"const Selectors = {\n    actions: {\n        showAlertButton: '[data-action=\"mod_example/helloworld-update_button\"]',\n    },\n};\n\nexport const init = () => {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.showAlertButton)) {\n            window.alert(\"Thank you for clicking on the button\");\n        }\n    });\n};\n")),(0,i.kt)("p",null,"This example shows several conventions that are used in Moodle:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"CSS Selectors are often stored separate to the code in a ",(0,i.kt)("inlineCode",{parentName:"li"},"Selectors"),"\nobject. This allows you to re-use a Selector and to group them\ntogether in different ways. It also places all selectors in one place so\nthat they're easier to update."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Selectors")," object is stored in a ",(0,i.kt)("inlineCode",{parentName:"li"},"const")," variable which is ","_","not","_","\nexported. This means that it's private and only available within your\nmodule."),(0,i.kt)("li",{parentName:"ul"},"A ",(0,i.kt)("inlineCode",{parentName:"li"},"data-*")," attribute is used to identify the button in the JavaScript\nmodule.\nMoodle advises not to use class selectors when attaching event listeners because\nso that it's easier to restyle for different themes without any changes to\nthe JavaScript later."),(0,i.kt)("li",{parentName:"ul"},"A namespace is used for the ",(0,i.kt)("inlineCode",{parentName:"li"},"data-action")," to identify what the button is intended for."),(0,i.kt)("li",{parentName:"ul"},"By using ",(0,i.kt)("inlineCode",{parentName:"li"},"e.target.closest()")," you can check whether the element that was\nclicked on, or any of its parent elements matches the supplied CSS Selector.")),(0,i.kt)("p",null,"Instead of having one event listener for every button in your page, you can\nhave one event listener which checks which button was pressed.\nIf you have a template like the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-handlebars",metastring:'title="mod/example/templates/helloworld.mustache"',title:'"mod/example/templates/helloworld.mustache"'},' <div>\n     <button data-action="mod_example/helloworld-update_button">Click me</button>\n     <button data-action="mod_example/helloworld-big_red_button">Do not click me</button>\n </div>\n')),(0,i.kt)("p",null,"Then you can write one event listener which looks at all buttons on the page.\nFor example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="mod/example/lib/amd/src/local/helloworld/selectors.js"',title:'"mod/example/lib/amd/src/local/helloworld/selectors.js"'},'export default {\n    actions: {\n        showAlertButton: \'[data-action="mod_example/helloworld-update_button"],\n        bigRedButton: \'[data-action="mod_example/helloworld-big_red_button"],\n    },\n};\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="mod/example/lib/amd/src/helloworld.js"',title:'"mod/example/lib/amd/src/helloworld.js"'},"import Selectors from './local/helloworld/selectors';\n\nconst registerEventListeners = () => {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.showAlertButton)) {\n            window.alert(\"Thank you for clicking on the button\");\n        }\n\n        if (e.target.closest(Selectors.actions.bigRedButton)) {\n            window.alert(\"You shouldn't have clicked on that one!\");\n        }\n    });\n};\n\nexport const init = () => {\n    registerEventListeners();\n};\n")),(0,i.kt)("p",null,"You will notice several key differences in this example when compared with the previous one:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The list of Selectors has been moved to a new Module which is included using\nthe ",(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/import"},"import")," keyword.\nThe new ",(0,i.kt)("inlineCode",{parentName:"li"},"selectors")," module is a dependency of the ",(0,i.kt)("inlineCode",{parentName:"li"},"helloworld")," module."),(0,i.kt)("li",{parentName:"ul"},"The call to ",(0,i.kt)("inlineCode",{parentName:"li"},"document.addEventListener")," has been moved to a new\n",(0,i.kt)("inlineCode",{parentName:"li"},"registerEventListeners")," function.\nThis is another Moodle convention which encourages you to structure your\ncode so that each part has clear responsibilities."),(0,i.kt)("li",{parentName:"ul"},"One event listener is present and it checks if the Element clicked on was\none that it's interested in.")),(0,i.kt)("h2",{id:"including-javascript-from-your-pages"},"Including JavaScript from your pages"),(0,i.kt)("p",null,"Once you have written a JavaScript module you need a way to include it within your content."),(0,i.kt)("p",null,"Moodle has three main ways to include your JavaScript and the best way will depend on your content. These are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"from a template via ",(0,i.kt)("inlineCode",{parentName:"li"},"requirejs"),";"),(0,i.kt)("li",{parentName:"ul"},"from PHP via the output requirements API; and"),(0,i.kt)("li",{parentName:"ul"},"from other JavaScript via ",(0,i.kt)("inlineCode",{parentName:"li"},"import")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"requirejs"),".")),(0,i.kt)("h3",{id:"including-from-a-template"},"Including from a template"),(0,i.kt)("p",null,"Most recent code in Moodle makes heavy use of Mustache templates and you will often find that your JavaScript is\ndirectly linked to the content of one of your templates."),(0,i.kt)("p",null,"All JavaScript in Mustache templates must be places in a ",(0,i.kt)("inlineCode",{parentName:"p"},"{{#js}}")," tag.\nThis tag ensures that all JavaScript is called in a consistent and reliable way."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You shouldn't add too much JavaScript directly to a template.\nJavaScript placed directly into Templates isn't transpiled for consistent use in all browsers and it isn't passed through minification processes.\nSome browser-specific features won't be available."))),(0,i.kt)("p",null,"This simplest form of this is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-handlebars",metastring:"title=mod/forum/templates/discussion.mustache",title:"mod/forum/templates/discussion.mustache"},"<div>\n    <!\u2014- Your template content goes here. \u2014->\n</div>\n\n{{#js}}\nrequire(['mod_forum/discussion'], function(Discussion) {\n    Discussion.init();\n});\n{{/js}}\n")),(0,i.kt)("p",null,"Any time that this template is rendered and placed on the page the ",(0,i.kt)("inlineCode",{parentName:"p"},"mod_forum/discussion")," module will be fetched and the ",(0,i.kt)("inlineCode",{parentName:"p"},"init()")," function called on it."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Since Moodle 4.0")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Moodle no longer supports Internet Explorer. It's now safe to use Arrow functions."))),(0,i.kt)("p",null,"Often you may want to link the JavaScript to a specific ",(0,i.kt)("inlineCode",{parentName:"p"},"DOMElement")," in the template.\nYou can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"{{uniqid}}")," Mustache tag to give that DOM Element a unique ID and then pass that into the Module."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-handlebars",metastring:"title=mod/forum/templates/discussion.mustache",title:"mod/forum/templates/discussion.mustache"},'<div id="mod_forum-discussion-wrapper-{{uniqid}}">\n    <!\u2014- Your template content goes here. \u2014->\n</div>\n\n{{#js}}\nrequire([\'mod_forum/discussion\'], function(Discussion) {\n    Discussion.init(document.querySelector("mod_forum-discussion-wrapper-{{uniqid}}"));\n});\n{{/js}}\n')),(0,i.kt)("p",null,"In this example you have added a new ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," to the ",(0,i.kt)("inlineCode",{parentName:"p"},"div")," element.\nYou then fetch the DOM Element using this id and pass it into the ",(0,i.kt)("inlineCode",{parentName:"p"},"init")," function."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"{{uniqid}}")," tag gives a new unique string for each rendered template including all its children.\nIt isn't a true unique id and must be combined with other information in the template to make it unique."))),(0,i.kt)("h3",{id:"including-from-php"},"Including from PHP"),(0,i.kt)("p",null,"Much of Moodle's code still creates HTML content in PHP directly.\nThis might be a simple ",(0,i.kt)("inlineCode",{parentName:"p"},"echo")," statement or using the ",(0,i.kt)("inlineCode",{parentName:"p"},"html_writer")," output functions.\nA lot of this content is being migrated to use Mustache Templates which are the recommended approach for new content."),(0,i.kt)("p",null,"Where content is generated in PHP you will need to include your JavaScript at the same time."),(0,i.kt)("p",null,"Although several older ways to include JavaScript from PHP, it's strongly\nrecommended that all new JavaScript only use the ",(0,i.kt)("inlineCode",{parentName:"p"},"js_call_amd")," function on the\n",(0,i.kt)("inlineCode",{parentName:"p"},"page_requirements_manager"),".\nThis has a similar format to the version used in Templates:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"// Call the `init` function on `mod_forum/discussion`.\n$PAGE->requires->js_call_amd('mod_forum/discussion', 'init');\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"js_call_amd")," function turns this into a ",(0,i.kt)("inlineCode",{parentName:"p"},"requirejs")," call."),(0,i.kt)("p",null,"You can also pass arguments to your function by passing an array as the third argument to ",(0,i.kt)("inlineCode",{parentName:"p"},"js_call_amd"),", for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"// Call the `init` function on `mod_forum/discussion`.\n$PAGE->requires->js_call_amd('mod_forum/discussion', 'init', [$course->id]);\n")),(0,i.kt)("p",null,"If you pass a multi-dimensional array as the third argument, then you can use Array destructuring within the JavaScript to get named values."),(0,i.kt)(l.mQ,{mdxType:"Tabs"},(0,i.kt)(l.E2,{value:"php-js_call_admin-args",label:"PHP",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$PAGE->requires->js_call_amd('mod_forum/discussion', 'init', [[\n    'courseid' => $course->id,\n    'categoryid' => $course->category,\n]]);\n"))),(0,i.kt)(l.E2,{value:"js-js_call_admin-args",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"export const init = ({courseid, category}) => {\n    window.console.log(courseid);\n    window.console.log(category);\n};\n")))),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"A limit applies to the length of the parameters passed in the third argument.\nIf data is already available elsewhere in the DOM, you should avoid passing it as a parameter."))),(0,i.kt)("h2",{id:"passing-data-to-your-module"},"Passing data to your Module"),(0,i.kt)("p",null,"You will often need to work with data as part of your JavaScript module.\nThis might be simple data, like the a database id, or it may be more complex\nlike full Objects."),(0,i.kt)("p",null,"Moodle provides several ways to achieve this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"you can pass a small amount of data into the module initialisation, but this is no longer recommended"),(0,i.kt)("li",{parentName:"ul"},"you can store this data in the DOM as a data attribute which is fetched in your code"),(0,i.kt)("li",{parentName:"ul"},"a Moodle Web Service can be used to fetch more complex data structures dynamically")),(0,i.kt)("h3",{id:"using-data-attributes"},"Using data attributes"),(0,i.kt)("p",null,"The easiest way to pass data is to use data attributes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-{eval-rst}"},".. TODO::\n\n    Document the main ways that we pass data.\n\n    Focus on:\n\n        * data- attributes in HTML being ready\n        * the limitations of the data passed into `js_call_amd`\n        * web services\n\n\n")),(0,i.kt)("h2",{id:"promises"},"Promises"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-{eval-rst}"},".. TODO::\n\n    We should document things like:\n\n        * Use ``then`` and ``catch`` consistently (thennables)\n        * Don't use ``catch`` if you are returning a Promise just by habit - only use it if you mean to\n        * You _must_ return at the end of a thennable\n        * It's generally a good idea to return a Promise from a fucntion if the function is primarily tasked with\n          creating that Promise\n")),(0,i.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You shouldn't use the ",(0,i.kt)("inlineCode",{parentName:"p"},"done"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"fail"),", or ",(0,i.kt)("inlineCode",{parentName:"p"},"always")," functions on Promises.\nThese are a jQuery feature which isn't present in the Native Promise implementation."))),(0,i.kt)("h3",{id:"examples"},"Examples"),(0,i.kt)(l.dn,{language:"js",title:"Create a modal in a function",mdxType:"CodeBlock"},"const getModal = questionBody => {\n    return ModalFactory.create({\n        title: getString('my_title', 'mod_example'),\n        body: renderTemplate('mod_example/example_body', questionBody),\n        removeOnClose: true,\n    })\n    .then(modal => {\n        modal.show();\n\n        return modal;\n    });\n};\n"),(0,i.kt)("h2",{id:"working-with-strings"},"Working with Strings"),(0,i.kt)("p",null,"One of the most helpful core modules is ",(0,i.kt)("inlineCode",{parentName:"p"},"core/str")," which allows you to fetch and render language Strings in JavaScript."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"core/str")," module has two main functions, which both return Promises containing the resolved string."),(0,i.kt)("p",null,"Strings are fetched on request from Moodle, and are then cached in LocalStorage."),(0,i.kt)(l.dn,{language:"js",title:"Example",mdxType:"CodeBlock"},"import {get_string as getString} from 'core/str';\n\ngetString('close', 'core')\n.then(closeString => {\n    window.console.log(closeString);\n\n    return closeString;\n})\n.catch();\n"),(0,i.kt)("h2",{id:"templates"},"Templates"),(0,i.kt)("h2",{id:"modals"},"Modals"),(0,i.kt)("h2",{id:"notifications"},"Notifications"),(0,i.kt)("h2",{id:"ajax-calls"},"AJAX Calls"),(0,i.kt)("h2",{id:"preferences"},"Preferences"),(0,i.kt)("h2",{id:"prefetch"},"Prefetch"),(0,i.kt)(l.U6,{versions:[3.9],mdxType:"Since"}),(0,i.kt)("p",null,"Assets including strings, and templates, can be pre-fetched shortly after the page loads to improve the perceived performance of the page when consuming those components."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-todo"},"Link to jsdocs here\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Example of fetching a string and template"',title:'"Example',of:!0,fetching:!0,a:!0,string:!0,and:!0,'template"':!0},"import Prefetch from 'core/prefetch';\n\n// Prefetch the string 'discussion' from the 'mod_forum' component.\nPrefetch.prefetchString('discussion', 'mod_forum');\n\n// Prefetch the strings yes, no, and maybe from the 'core' component.\nPrefetch.prefetchStrings('core', ['yes', 'no', 'maybe']);\n\n// Prefetch the templates 'core/toast'.\nPrefetch.prefetchTemplate('core/toast');\n\n// Prefetch the templates 'core/toast' and 'core/modal'.\nPrefetch.prefetchTemplates(['core/toast', 'core/modal']);\n")),(0,i.kt)("h2",{id:"reactive-state"},"Reactive state"),(0,i.kt)(l.U6,{versions:[4],mdxType:"Since"}),(0,i.kt)("p",null,"Reactivity is one of the latest developments patterns incorporated to web development. Frameworks like React, Angular and Vue are competing for being the standard for web applications. However, for now there is not a clear winner on what is the best solution in terms of performance, standarizations and reusability."),(0,i.kt)("p",null,"While third-party developers are free to use any reactive framework they want, core developments are framework independant. Nevertheless, some part of Moodle implements a basic reactive state pattern by an adhoc library. This library does not represent a full reactive solution but helps implementing resuable and easy to mantain frontend applications."),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"./javascript/reactive"},"Creating reactive UI")," for more information."),(0,i.kt)("h2",{id:"tools"},"Tools"),(0,i.kt)("p",null,"Moodle uses common and popular tools to ensure code quality, and to improve the\nend-user experience."),(0,i.kt)("p",null,"Most of the Moodle JavaScript tooling requires ",(0,i.kt)("a",{parentName:"p",href:"/general/development/tools/nodejs"},"NodeJS"),"."),(0,i.kt)("h3",{id:"grunt"},"Grunt"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://gruntjs.com/"},"Grunt")," is a command-line tool used to compile JavaScript, and CSS, and to lint JavaScript, CSS, and Behat tests."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Rather than running ",(0,i.kt)("inlineCode",{parentName:"p"},"grunt")," on the entire Moodle source every time you make changes, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"grunt watch"),"\nin the background to build just the files you change as you write them."))),(0,i.kt)("h4",{id:"installing-grunt"},"Installing grunt"),(0,i.kt)(l.mQ,{mdxType:"Tabs"},(0,i.kt)(l.E2,{value:"global_grunt",label:"Global",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"npm -g install grunt-cli\n")))),(0,i.kt)("h4",{id:"using-grunt"},"Using grunt"),(0,i.kt)(l.mQ,{mdxType:"Tabs"},(0,i.kt)(l.E2,{value:"npx_grunt",label:"NPX",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npx grunt\n"))),(0,i.kt)(l.E2,{value:"global_grunt",label:"Global",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"grunt\n")))),(0,i.kt)("h3",{id:"eslint"},"ESLint"))}v.isMDXComponent=!0}}]);