define ("editor_marklar/imagepaster",["jquery","core/log","core/config"],function(a,b,c){"use strict";function d(a,b,c){var d=this;d.textarea=a;d.imagepickeroptions=b;d.callback=c;d.initPasteListener()}d.prototype.initPasteListener=function(){var a=this;a.textarea.on("paste",function(b){for(var c=b.originalEvent.clipboardData.items,d=0,e;d<c.length;d++){e=c[d];if(0===e.type.indexOf("image/")){a.uploadImage(e.getAsFile())}}})};d.prototype.uploadImage=function(d){for(var e=this,f=(1e3*Math.random()).toString().replace(".","")+"_"+d.name,g=window.Object.keys(e.imagepickeroptions.repositories),h=new window.FormData,j=!1,k=0;k<g.length;k++){if("upload"===e.imagepickeroptions.repositories[g[k]].type){h.append("repo_id",e.imagepickeroptions.repositories[g[k]].id);j=!0;break}}if(!j){return}h.append("repo_upload_file",d,f);h.append("itemid",e.imagepickeroptions.itemid);h.append("author",e.imagepickeroptions.author);h.append("env",e.imagepickeroptions.env);h.append("sesskey",c.sesskey);h.append("client_id",e.imagepickeroptions.client_id);if(e.imagepickeroptions.context.id){h.append("ctx_id",e.imagepickeroptions.context.id)}a.ajax(c.wwwroot+"/repository/repository_ajax.php?action=upload",{type:"POST",data:h,dataType:"json",processData:!1,contentType:!1,async:!0}).done(function(a){if("error"in a){b.error("imagepaster: error uploading image: "+a.errorcode+": "+a.error)}else{e.callback(a)}}).fail(function(a){b.error("imagepaster: error uploading image: "+a.status+" "+a.statusText)})};return{init:function init(c,e,f){var g;if("string"==typeof c){g=a(document.getElementById(c))}else{g=a(c)}if(!g.length){b.error("imagepaster: invalid editor textarea element");return!1}if(!e){b.error("imagepaster: invalid image picker options");return!1}if(!f||"function"!=typeof f){b.error("imagepaster: invalid callback specified");return!1}return new d(g,e,f)}}});
//# sourceMappingURL=imagepaster.min.js.map
