# Include this file into the apache vhost configuration file
# for this site.

ErrorDocument 401 "/error/index.php?status=401"
ErrorDocument 403 "/error/index.php?status=403"
ErrorDocument 404 "/error/index.php?status=404"
ErrorDocument 408 "/error/index.php?status=408"
ErrorDocument 500 "/error/index.php?status=500"
ErrorDocument 501 "/error/index.php?status=501"
ErrorDocument 502 "/error/index.php?status=502"
ErrorDocument 503 "/error/index.php?status=503"
ErrorDocument 504 "/error/index.php?status=504"
ErrorDocument 505 "/error/index.php?status=505"

RewriteEngine On
#RewriteLog "/home/mudrd8mz/www/logs/moodleorg_rewrite_log"
#RewriteLogLevel 9

# When attempting to access the site configuration files, throw 404
RewriteCond %{REQUEST_URI} ^/local/moodleorg/top\.htaccess$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/local/moodleorg/conf/(.*)$ [NC]
RewriteRule . - [R=404,L]

RewriteCond %{QUERY_STRING} ^d=http:// [NC]
RewriteRule . - [F,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=release\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Release_Notes? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=developer\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Developer_documentation? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=credits\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Credits? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=install\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Administrator_documentation? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=philosophy\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Philosophy? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=installamp\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Administrator_documentation? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=upgrade\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Administrator_documentation? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=cvs\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/CVS? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=teacher\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Teacher_documentation? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=coding\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Coding? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=future\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Future? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=faq\.html(.*)$
RewriteRule ^/doc/$ http://docs.moodle.org/en/FAQ? [R=301,L]

RewriteCond %{QUERY_STRING} ^(.*)f(.*)=translation\.html$
RewriteRule ^/doc/$ http://docs.moodle.org/en/Translation? [R=301,L]

RewriteCond %{QUERY_STRING} ^id=10$
RewriteRule ^/course/view.php$ /demo? [R=301,L]

RewriteCond %{QUERY_STRING} ^d=42952$
RewriteRule ^/mod/forum/discuss.php$ /mod/forum/discuss.php?d=42954 [R=301,L]

RewriteCond %{QUERY_STRING} ^id=893$
RewriteRule ^/mod/forum/view.php$ /course/view.php?id=55 [R=301,L]

RewriteCond %{QUERY_STRING} ^id=7169$
RewriteRule ^/mod/forum/view.php$ /mod/data/view.php?d=54

RewriteCond %{QUERY_STRING} ^id=7080$
RewriteRule ^/mod/resource/view.php$ /mod/forum/view.php?id=7128 [R=301,L]

RewriteCond %{REQUEST_URI} ^/wiki(/|$) [NC]
RewriteRule . http://docs.moodle.org [R=301,L]

RewriteCond %{REQUEST_URI} ^/bugs(/|$) [NC]
RewriteRule . https://tracker.moodle.org/browse/MDL [R=301,L]

RewriteCond %{REQUEST_URI} ^/assets/skins/sam/yui_image\.php$ [NC]
RewriteRule . /theme/yui_image.php [R=301,L]

RewriteCond %{REQUEST_URI} ^/xref(/|$) [NC]
RewriteRule . http://xref.moodle.org [R=301,L]

RewriteCond %{REQUEST_URI} ^/hosting(/|$) [NC]
RewriteRule . https://moodle.com/partners [R=301,L]

RewriteCond %{REQUEST_URI} ^/helpdesk(/|$) [NC]
RewriteRule . http://moodle.com/helpdesk [R=301,L]

RewriteCond %{REQUEST_URI} ^/news/news\.xml$ [NC]
RewriteRule . /rss/file.php/1/1/forum/1/rss.xml [R=301,L]

RewriteCond %{REQUEST_URI} ^/useful/rss\.php$ [NC]
RewriteRule . /local/moodleorg/top/useful/rss.php [L]

RewriteCond %{REQUEST_URI} ^/resources/rss\.php$ [NC]
RewriteRule . /local/moodleorg/top/resources/rss.php [L]

RewriteCond %{REQUEST_URI} ^/useful(/|$) [NC]
RewriteRule . / [R=301,L]

RewriteCond %{REQUEST_URI} ^/download\.php$ [NC]
RewriteRule . http://download.moodle.org/download.php [R=301,L]

RewriteCond %{REQUEST_URI} ^/(docs|doc)(/|$) [NC]
RewriteRule . http://docs.moodle.org [R=301,L]

RewriteCond %{REQUEST_URI} ^/support/commercial(/|$) [NC]
RewriteRule . http://moodle.com [R=301,L]

RewriteCond %{REQUEST_URI} ^/support(/|$) [NC]
RewriteRule . /course [R=301,L]

RewriteCond %{REQUEST_URI} ^/mozillahelp(/$) [NC]
RewriteRule . http://mozilla.org/editor/midasdemo/securityprefs.html [R=301,L]

RewriteCond %{REQUEST_URI} ^/release\.html$ [NC]
RewriteRule . http://docs.moodle.org/en/Release_Notes [R=301,L]

RewriteCond %{REQUEST_URI} ^/donation(/|$) [NC]
RewriteRule . /donations/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/help(/|$) [NC]
RewriteRule . /course/view.php?id=5 [R=301,L]

RewriteCond %{REQUEST_URI} ^/buzz(/|$) [NC]
RewriteRule . /mod/data/view.php?id=6140 [R=301,L]

RewriteCond %{REQUEST_URI} ^/themes(/|$) [NC]
RewriteRule . /plugins/browse.php?list=category&id=3 [R=301,L]

RewriteCond %{REQUEST_URI} ^/philosophy(/|$) [NC]
RewriteRule . http://docs.moodle.org/en/Philosophy [R=301,L]

RewriteCond %{REQUEST_URI} ^/faq(/|$) [NC]
RewriteRule . http://docs.moodle.org/en/Category:FAQ [R=301,L]

RewriteCond %{REQUEST_URI} ^/modules(/|$) [NC]
RewriteRule . /mod/data/view.php?id=6009 [R=301,L]

RewriteCond %{REQUEST_URI} ^/cvs(/|$) [NC]
RewriteRule . /dev/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/jobs(/|$) [NC]
RewriteRule . /mod/data/view.php?d=54 [R=301,L]

RewriteCond %{REQUEST_URI} ^/books(/|$) [NC]
RewriteRule . /mod/data/view.php?id=7246 [R=301,L]

RewriteCond %{REQUEST_URI} ^/mod/newmodule_template.zip$ [NC]
RewriteRule . http://download.moodle.org/modules/NEWMODULE.zip [R=301,L]

RewriteCond %{REQUEST_URI} ^/(phpwcms|bookmark4u|_vti_bin|MSOffice|mod/forum/ws) [NC]
RewriteRule . - [F,L]

RewriteCond %{REQUEST_URI} ^/public(/?)$ [NC]
RewriteRule . /public/search/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/favicon\.ico$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/invaders\.swf$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/moodle\.gif$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/nagvercheck\.php$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/robots\.txt$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/upgradeinprogress\.html$ [NC]
RewriteRule ^(.*)$ /local/moodleorg/top$1 [L]

RewriteCond %{REQUEST_URI} ^/audio(/|$) [NC]
RewriteRule . / [R=301,L]

RewriteCond %{REQUEST_URI} ^/forums/my(/|$) [NC]
RewriteRule ^(.*)$ /my [R=301,L]

RewriteCond %{REQUEST_URI} ^/community(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/forums(/|$) [NC]
RewriteRule ^(.*)$ /course [R=301,L]

RewriteCond %{REQUEST_URI} ^/development(/|$) [NC]
RewriteRule . http://docs.moodle.org/dev/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/downloads(/|$) [NC]
RewriteRule . http://download.moodle.org/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/events(/|$) [NC]
RewriteRule ^(.*)$ /calendar [R=301,L]

RewriteCond %{REQUEST_URI} ^/stories(/|$) [NC]
RewriteRule . http://moodle.com/stories/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/sites(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/stats(/|$) [NC]
RewriteRule ^(.*)$ http://moodle.net$1 [R=301,L]

RewriteCond %{REQUEST_URI} ^/userpics(/|$) [NC]
RewriteRule ^(.*)$ / [R=301,L]

RewriteCond %{REQUEST_URI} ^/about(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/cafepress(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/demo(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/donations(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/features(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/images(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/maintenance/(.+\.png$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/network(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/news(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/other(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/planet(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/public/search(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/register(/|$) [NC,OR]
RewriteCond %{REQUEST_URI} ^/security(/|$) [NC]
RewriteRule ^(.*)$ /local/moodleorg/top$1 [L]

RewriteCond %{REQUEST_URI} ^/logo(/|$) [NC]
RewriteRule ^(.*)$ /mod/page/view.php?id=8338 [R=301,L]

RewriteCond %{REQUEST_URI} ^/privacy(/|$) [NC]
RewriteRule ^(.*)$ /admin/tool/policy/view.php?policyid=1 [R=301,L]

RewriteCond %{REQUEST_URI} ^/contact(/|$) [NC]
RewriteRule ^(.*)$ /mod/page/view.php?id=8191 [R=301,L]

RewriteCond %{REQUEST_URI} ^/social(/|$) [NC]
RewriteRule ^(.*)$ /mod/page/view.php?id=8213 [R=301,L]

RewriteCond %{REQUEST_URI} ^/theme/moodle2(/|$) [NC]
RewriteRule ^/theme/moodle2(.*)$ /local/moodleorg/top/theme/moodle2$1 [L]

RewriteCond %{REQUEST_URI} ^/plugins/view/.+ [NC]
RewriteRule ^/plugins/view/([^/]+)/?$ /plugins/$1 [R=301,L]

RewriteCond %{REQUEST_URI} ^/plugins/[a-z]+_[a-z0-9_]*[a-z0-9]+ [NC]
RewriteRule ^/plugins/([a-z]+_(?:[a-z0-9_])*[a-z0-9]+)/?$ /local/plugins/view.php?plugin=$1 [L,QSA]
RewriteRule ^/plugins/([a-z]+_(?:[a-z0-9_])*[a-z0-9]+)/versions/?$ /local/plugins/pluginversions.php?plugin=$1 [L,QSA]
RewriteRule ^/plugins/([a-z]+_(?:[a-z0-9_])*[a-z0-9]+)/stats/?$ /local/plugins/stats.php?plugin=$1 [L,QSA]
RewriteRule ^/plugins/([a-z]+_(?:[a-z0-9_])*[a-z0-9]+)/translations/?$ /local/plugins/translations.php?plugin=$1 [L,QSA]
RewriteRule ^/plugins/([a-z]+_(?:[a-z0-9_])*[a-z0-9]+)/devzone/?$ /local/plugins/devzone.php?plugin=$1 [L,QSA]
RewriteRule ^/plugins/([a-z]+_(?:[a-z0-9_])*[a-z0-9]+)/[^/]+/([0-9]+)/?$ /local/plugins/pluginversion.php?id=$2 [L,QSA]

RewriteCond %{REQUEST_URI} ^/plugins(/|$) [NC]
RewriteRule ^/plugins(.*)$ /local/plugins$1 [L]

RewriteCond %{REQUEST_URI} ^/dev(/|$) [NC]
RewriteRule ^/dev(.*)$ /local/dev$1 [L]

RewriteCond %{REQUEST_URI} ^/mod/cvsadmin/view\.php [NC]
RewriteCond %{QUERY_STRING} ^conversationid= [NC]
RewriteRule . /local/chatlogs/index.php [R=301,QSA,L]

RewriteCond %{REQUEST_URI} ^/mod/cvsadmin/view\.php [NC]
RewriteCond %{QUERY_STRING} ^tab=chat$ [NC]
RewriteRule . /local/chatlogs/index.php [R=301,L]

RewriteCond %{REQUEST_URI} ^/mod/cvsadmin/view\.php [NC]
RewriteCond %{QUERY_STRING} ^cid=1$ [NC]
RewriteRule . /dev/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/course/view\.php [NC]
RewriteCond %{QUERY_STRING} ^id=33$ [NC]
RewriteRule . /calendar/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/course/view\.php [NC]
RewriteCond %{QUERY_STRING} ^id=15$ [NC]
RewriteRule . http://hub.moodle.org [R=301,L]

RewriteCond %{REQUEST_URI} ^/course/view\.php [NC]
RewriteCond %{QUERY_STRING} ^id=55$ [NC]
RewriteRule . /mod/forum/view.php?f=934 [R=301,L]

RewriteCond %{REQUEST_URI} ^/local/cafepress(/|$) [NC]
RewriteRule ^/local/cafepress(.*)$ /local/moodleorg/top/cafepress$1 [L]

RewriteCond %{REQUEST_URI} ^/error(/|$) [NC]
RewriteRule ^/error(.*)$ /local/moodleorg/top/error$1 [L]

RewriteCond %{REQUEST_URI} ^/educators(/|$) [NC]
RewriteRule . /course/view.php?id=17223 [R=301,L]

RewriteCond %{REQUEST_URI} ^/project_inspire(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/Project_Inspire(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/learning_analytics(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/Learning_Analytics(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/Learning_analytics(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/analytics(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/Analytics(/|$) [NC]
RewriteRule . /course/view.php?id=17233 [R=301,L]

RewriteCond %{REQUEST_URI} ^/\.git(/|$) [NC]
RewriteRule . - [R=404,L]
