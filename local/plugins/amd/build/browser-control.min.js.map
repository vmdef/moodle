{"version":3,"sources":["../src/browser-control.js"],"names":["define","$","Log","BrowserControl","region","browserGrid","self","initFilterForm","initSortForm","prototype","filterForm","find","first","length","error","on","e","preventDefault","submitControlForm","highlightCurrentlyUsedFields","submit","attr","sortForm","sortlink","currentTarget","val","highlightCurrentSortLink","currentSortBy","removeClass","addClass","fields","each","ix","field","removeAttr","query","buildBrowserQuery","serializeArray","search","values","i","name","value","trim","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implements the behaviour of the filter form on the front page.\n *\n * @module      local_plugins/browser-control\n * @package     local_plugins\n * @subpackage  amd\n * @category    output\n * @copyright   2016 David Mudr√°k <david@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n        'jquery',\n        'core/log',\n],\nfunction ($, Log) {\n    'use strict';\n\n    /**\n     * Represents the browser control widget on the screen.\n     *\n     * @constructor\n     * @param {jQuery} region\n     * @param {Object} browserGrid\n     */\n    function BrowserControl(region, browserGrid) {\n\n        var self = this;\n\n        self.region = region;\n        self.browserGrid = browserGrid;\n\n        self.initFilterForm();\n        self.initSortForm();\n    }\n\n    /**\n     * Initialize the filter form.\n     *\n     * @method\n     */\n    BrowserControl.prototype.initFilterForm = function () {\n\n        var self = this;\n\n        self.filterForm = self.region.find('[data-widget=\"browser-filter-form\"]').first();\n\n        if (!self.filterForm.length) {\n            Log.error('Filter form widget not found');\n            return;\n        }\n\n        self.filterForm.on('submit', function(e) {\n            e.preventDefault();\n            self.submitControlForm();\n        });\n\n        self.filterForm.find('select,input').on('change', function() {\n            self.highlightCurrentlyUsedFields();\n        });\n\n        self.filterForm.find('select').on('change', function() {\n            self.filterForm.submit();\n        });\n\n        self.filterForm.find('[data-widget=\"advanced-filter-hide\"]').on('click', function(e) {\n            e.preventDefault();\n            self.filterForm.attr('data-show-advanced', '');\n        });\n\n        self.filterForm.find('[data-widget=\"advanced-filter-show\"]').on('click', function(e) {\n            e.preventDefault();\n            self.filterForm.attr('data-show-advanced', '1');\n        });\n\n        self.highlightCurrentlyUsedFields();\n    };\n\n    /**\n     * Initialize the sorting panel.\n     *\n     * @method\n     */\n    BrowserControl.prototype.initSortForm = function () {\n\n        var self = this;\n\n        self.sortForm = self.region.find('[data-widget=\"browser-sort-form\"]').first();\n\n        if (!self.sortForm.length) {\n            Log.error('Sort form widget not found');\n            return;\n        }\n\n        self.sortForm.find('[data-sortby]').on('click', function (e) {\n            e.preventDefault();\n            var sortlink = $(e.currentTarget);\n            self.filterForm.find('input[name=\"sort-by\"]').val(sortlink.attr('data-sortby'));\n            self.highlightCurrentSortLink();\n            self.submitControlForm();\n        });\n\n        self.highlightCurrentSortLink();\n    };\n\n    /**\n     * Highlights the currently active sort link.\n     *\n     * @method\n     */\n    BrowserControl.prototype.highlightCurrentSortLink = function () {\n\n        var self = this;\n        var currentSortBy = self.filterForm.find('input[name=\"sort-by\"]').val();\n\n        self.sortForm.find('[data-sortby]').removeClass('current');\n        self.sortForm.find('[data-sortby=\"' + currentSortBy + '\"]').addClass('current');\n    };\n\n    /**\n     * Highlights the currently activated filter form fields.\n     *\n     * @method\n     */\n    BrowserControl.prototype.highlightCurrentlyUsedFields = function () {\n\n        var self = this;\n        var fields = self.filterForm.find('[data-widget=\"descriptor-dropdown\"],input[name=\"search\"]');\n\n        fields.removeClass('current');\n        fields.each(function (ix, field) {\n            field = $(field);\n            if (field.val() !== '') {\n                field.addClass('current');\n                field.removeAttr('data-is-advanced');\n            }\n        });\n    };\n\n    /**\n     * Handle the filter form submission.\n     *\n     * @method\n     */\n    BrowserControl.prototype.submitControlForm = function () {\n\n        var self = this;\n        var query = buildBrowserQuery(self.filterForm.serializeArray());\n\n        self.browserGrid.search(query);\n    };\n\n    /**\n     * Prepares the browser query string from the form values.\n     *\n     * @private\n     * @param {Array} values as returned by jQuery.serializeArray()\n     */\n    function buildBrowserQuery(values) {\n\n        var query = '';\n\n        $.each(values, function(i, field) {\n            if (field.name === \"search\") {\n                // Keyword search box.\n                query += ' ' + field.value;\n\n            } else if (field.value !== \"\") {\n                // Descriptor dropdown selector.\n                query += ' ' + field.name + ':' + field.value;\n            }\n        });\n\n        return query.trim();\n    }\n\n    return {\n        /**\n         * Factory method for browser control instance.\n         *\n         * @param {jQuery} region\n         * @param {Object} browserGrid\n         */\n        init: function (region, browserGrid) {\n            return new BrowserControl(region, browserGrid);\n        }\n    };\n});\n"],"file":"browser-control.min.js"}