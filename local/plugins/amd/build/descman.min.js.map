{"version":3,"sources":["../src/descman.js"],"names":["define","$","fragment","notification","templates","Y","autocomplete","showDescriptorForm","e","select","target","contextid","attr","descid","val","length","loadFragment","done","html","js","niceReplaceNode","fail","exception","node","promise","Deferred","fadeOut","replaceNode","fadeIn","resolve","init","on","each","enhance"],"mappings":"AAwBAA,OAAM,yBAAC,CAAC,QAAD,CACC,eADD,CAEC,mBAFD,CAGC,gBAHD,CAIC,UAJD,CAKC,wBALD,CAAD,CAMC,SAASC,CAAT,CAAYC,CAAZ,CAAsBC,CAAtB,CAAoCC,CAApC,CAA+CC,CAA/C,CAAkDC,CAAlD,CAAgE,CAEnE,aAUA,QAASC,CAAAA,CAAT,CAA4BC,CAA5B,CAA+B,IACvBC,CAAAA,CAAM,CAAGR,CAAC,CAACO,CAAC,CAACE,MAAH,CADa,CAEvBC,CAAS,CAAGF,CAAM,CAACG,IAAP,CAAY,gBAAZ,CAFW,CAGvBC,CAAM,CAAGJ,CAAM,CAACK,GAAP,EAHc,CAIvBJ,CAAM,CAAGT,CAAC,CAAC,oCAAD,CAJa,CAM3B,GAAI,CAACS,CAAM,CAACK,MAAZ,CAAoB,CAChB,MACH,CAEDb,CAAQ,CAACc,YAAT,CAAsB,eAAtB,CAAuC,iBAAvC,CAA0DL,CAA1D,CAAqE,CAAC,OAAUE,CAAX,CAArE,EACKI,IADL,CACU,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACrBC,CAAe,CAACV,CAAD,CAASQ,CAAT,CAAeC,CAAf,CAClB,CAHL,EAIKE,IAJL,CAIUlB,CAAY,CAACmB,SAJvB,CAKH,CAYD,QAASF,CAAAA,CAAT,CAAyBG,CAAzB,CAA+BL,CAA/B,CAAqCC,CAArC,CAAyC,CACrC,GAAIK,CAAAA,CAAO,CAAGvB,CAAC,CAACwB,QAAF,EAAd,CAEAF,CAAI,CAACG,OAAL,CAAa,MAAb,CAAqB,UAAW,CAC5BtB,CAAS,CAACuB,WAAV,CAAsBJ,CAAtB,CAA4BL,CAA5B,CAAkCC,CAAlC,EACAI,CAAI,CAACK,MAAL,CAAY,MAAZ,CAAoB,UAAW,CAC3BJ,CAAO,CAACK,OAAR,EACH,CAFD,CAGH,CALD,EAOA,MAAOL,CAAAA,CAAO,CAACA,OAAR,EACV,CAED,MAAO,CACHM,IAAI,CAjDR,UAAgB,CACZ7B,CAAC,CAAC,uCAAD,CAAD,CAAyC8B,EAAzC,CAA4C,QAA5C,CAAsDxB,CAAtD,EACAN,CAAC,CAAC,6BAAD,CAAD,CAA+B+B,IAA/B,CAAoC,UAAW,CAC3C,GAAIvB,CAAAA,CAAM,CAAGR,CAAC,CAAC,IAAD,CAAd,CACAK,CAAY,CAAC2B,OAAb,CAAqB,IAAIxB,CAAM,CAACG,IAAP,CAAY,IAAZ,CAAzB,IAAkD,EAAlD,CAAsDH,CAAM,CAACG,IAAP,CAAY,gBAAZ,CAAtD,OACH,CAHD,CAIH,CA0CM,CAGV,CA7DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controller for the descriptors management page\n *\n * @module      local_plugins/descman\n * @package     local_plugins\n * @copyright   2016 David Mudr√°k <david@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/fragment',\n        'core/notification',\n        'core/templates',\n        'core/yui',\n        'core/form-autocomplete'\n    ], function($, fragment, notification, templates, Y, autocomplete) {\n\n    'use strict';\n\n    function init() {\n        $('[data-widget=\"desc-manage-trigger\"]').on('change', showDescriptorForm);\n        $('[data-widget=\"desc-fill\"]').each(function() {\n            var select = $(this);\n            autocomplete.enhance('#'+select.attr('id'), true, '', select.attr('data-desctitle'), false, true);\n        });\n    }\n\n    function showDescriptorForm(e) {\n        var select = $(e.target);\n        var contextid = select.attr('data-contextid');\n        var descid = select.val();\n        var target = $('[data-widget=\"desc-form-target\"]');\n\n        if (!target.length) {\n            return;\n        }\n\n        fragment.loadFragment('local_plugins', 'descriptor_form', contextid, {'descid': descid})\n            .done(function(html, js) {\n                niceReplaceNode(target, html, js);\n            })\n            .fail(notification.exception);\n    }\n\n    /**\n     * Fade the node out, update it, and fade it back.\n     *\n     * @private\n     * @method niceReplaceNodeContents\n     * @param {JQuery} node\n     * @param {String} html\n     * @param {String} js\n     * @return {Deferred} promise resolved when the animations are complete.\n     */\n    function niceReplaceNode(node, html, js) {\n        var promise = $.Deferred();\n\n        node.fadeOut(\"fast\", function() {\n            templates.replaceNode(node, html, js);\n            node.fadeIn(\"fast\", function() {\n                promise.resolve();\n            });\n        });\n\n        return promise.promise();\n    }\n\n    return {\n        init: init\n    };\n});\n"],"file":"descman.min.js"}