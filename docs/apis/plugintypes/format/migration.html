<!doctype html>
<html lang="en-AU" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-apis/plugintypes/format/migration">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L9EE8RW5B1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-L9EE8RW5B1",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Moodle Developer Resources" href="/devdocs/opensearch.xml">


<link rel="icon" href="/devdocs/img/icons/orange_m.svg">
<link rel="manifest" href="/devdocs/manifest.json">
<meta name="theme-color" content="rgb(208, 99, 0)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/devdocs/img/icons/maskable_icon.png">
<link rel="mask-icon" href="/devdocs/img/icons/maskable_icon.png" color="rgb(208, 99, 0)">
<meta name="msapplication-TileImage" content="/devdocs/img/icons/maskable_icon.png">
<meta name="msapplication-TileColor" content="#000"><title data-rh="true">Migrating 3.11 formats | Moodle Developer Resources</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://moodledev.io/devdocs/docs/apis/plugintypes/format/migration"><meta data-rh="true" name="docusaurus_locale" content="en-AU"><meta data-rh="true" name="docsearch:language" content="en-AU"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrating 3.11 formats | Moodle Developer Resources"><meta data-rh="true" name="description" content="The new course editor introduced n Moodle 4.0 reimplements most of the previous webservices, AMD modules, and internal logic of the course rendering. However, all formats since 3.11 will use the previous libraries by default until its final deprecation in Moodle 4.3. This document collects the main adaptations any 3.11 course format will require to continue working when this happens."><meta data-rh="true" property="og:description" content="The new course editor introduced n Moodle 4.0 reimplements most of the previous webservices, AMD modules, and internal logic of the course rendering. However, all formats since 3.11 will use the previous libraries by default until its final deprecation in Moodle 4.3. This document collects the main adaptations any 3.11 course format will require to continue working when this happens."><link data-rh="true" rel="icon" href="/devdocs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://moodledev.io/devdocs/docs/apis/plugintypes/format/migration"><link data-rh="true" rel="alternate" href="https://moodledev.io/devdocs/docs/apis/plugintypes/format/migration" hreflang="en-AU"><link data-rh="true" rel="alternate" href="https://moodledev.io/devdocs/docs/apis/plugintypes/format/migration" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NNUY2D5GV2-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/devdocs/assets/css/styles.294a7229.css">
<link rel="preload" href="/devdocs/assets/js/runtime~main.108433aa.js" as="script">
<link rel="preload" href="/devdocs/assets/js/main.2dbacd86.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/devdocs/"><div class="navbar__logo"><img src="/devdocs/img/Moodle.svg" alt="Moodle Developer Resources" class="themedImage_ToTc themedImage--light_HNdA" height="35px" width="138px"><img src="/devdocs/img/Moodle.svg" alt="Moodle Developer Resources" class="themedImage_ToTc themedImage--dark_i4oU" height="35px" width="138px"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/devdocs/docs">Guides</a><a class="navbar__item navbar__link" href="/devdocs/general/community/contribute">Community</a><a class="navbar__item navbar__link" href="/devdocs/general/development/gettingstarted">Coding</a><a class="navbar__item navbar__link" href="/devdocs/general/development/process">Process</a></div><div class="navbar__items navbar__items--right"><div class="wrapper_Jz6K"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/devdocs/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/devdocs/docs/guides">Developer guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/devdocs/docs/apis">API guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;API guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/commonfiles">Common files</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/devdocs/docs/apis/core">Core APIs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Core APIs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/devdocs/docs/apis/plugintypes">Plugin types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Plugin types&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/antivirus">Antivirus plugins</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/devdocs/docs/apis/plugintypes/assign">Assignment sub-plugins</a><button aria-label="Toggle the collapsible sidebar category &#x27;Assignment sub-plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/blocks">Block plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/enrol">Enrolment plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/fileconverter">File Converters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/filter">Filter plugins</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/devdocs/docs/apis/plugintypes/format">Course format</a><button aria-label="Toggle the collapsible sidebar category &#x27;Course format&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/devdocs/docs/apis/plugintypes/format/migration">Migrating 3.11 formats</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/local">Local plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/mlbackend">Machine learning backends</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/mod">Activity modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/qbank">Question Bank plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/devdocs/docs/apis/plugintypes/repository">Repository plugins</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/devdocs/docs/category/subsystems">Subsystems</a><button aria-label="Toggle the collapsible sidebar category &#x27;Subsystems&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/devdocs/docs/devupdate">Developer update</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><hr></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/devdocs/docs/moodleapp">Moodle App</a><button aria-label="Toggle the collapsible sidebar category &#x27;Moodle App&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><hr></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/devdocs/general/releases/4.0">Release notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/devdocs/general/projects">Projects</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/devdocs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/devdocs/docs/apis"><span itemprop="name">API guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/devdocs/docs/apis/plugintypes"><span itemprop="name">Plugin types</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/devdocs/docs/apis/plugintypes/format"><span itemprop="name">Course format</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migrating 3.11 formats</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: master</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migrating 3.11 formats</h1></header><p>The new course editor introduced n Moodle 4.0 reimplements most of the previous webservices, AMD modules, and internal logic of the course rendering. However, all formats since 3.11 will use the previous libraries by default until its final deprecation in Moodle 4.3. This document collects the main adaptations any 3.11 course format will require to continue working when this happens.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changes-summary">Changes summary<a class="hash-link" href="#changes-summary" title="Direct link to heading">​</a></h2><p>The main areas affected by the new 4.0 course editor are:</p><ul><li>Course format plugins are now part of the <code>core_courseformat</code> subsystem</li><li>The old format_base class is now <code>core_courseformat\base</code> and it is mandatory for all format plugins to extend.</li><li>Format plugin renderer is now mandatory (and in most cases they will extend <code>core_courseformat\output\section_renderer</code>)</li><li>The old format_section_renderer_base is now <code>core_courseformat\output\section_renderer</code></li><li>The <code>core_courseformat\output\section_renderer</code> class now it extends core_course_renderer directly. This means that <code>$this-&gt;courserenderer</code> attribute is deprecated.</li><li>All renderer methods using html_writer are deprecated. All UI elements are now rendered using output classes and mustache files. Formats can provide alternative output classes and templates.</li><li>The new editor uses data attributes instead of CSS classes to locate section and activities elements in the page HTML. All elements must add those attributes to use the new AMD modules.</li><li>Most of the logic of the previous core_course/actions AMD module is now replaced with core_courseformat AMD modules, each one corresponding to the specific UI elements.</li><li>Formats can override the <code>core_courseformat\base::uses_course_index</code> in their base class to enable the course index.</li><li>Formats can override the <code>core_courseformat\base::supports_components</code> in their base class to use the new course editor library instead of the legacy one.</li><li>The course frontend uses a reactive state to maintain the UI elements updated. Format plugins can create new reactive AMD modules to interact with that state or extend the core_courseformat state classes to extend the data stored in that state.</li><li>Course formats now can implement the <code>core_courseformat\base::delete_format_data</code>  hook to clean data when the course is deleted.</li><li>The course <code>format_base</code> class now provides a method <code>show_editor</code> to know if the user is editing or not the course depending on the page editing and the user capabilities. This method should be used instead of the previous <code>$PAGE-&gt;user_is_editing() &amp;&amp; has_capability(&#x27;moodle/course:update&#x27;, $coursecontext)</code>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="moodle-311-vs-40-course-editor-architecture">Moodle 3.11 vs 4.0 course editor architecture<a class="hash-link" href="#moodle-311-vs-40-course-editor-architecture" title="Direct link to heading">​</a></h2><p>The 4.0 course editor follows a completely new pattern that is not compatible with the previous one. That new pattern is called <strong>reactive components</strong>.</p><p>To ensure all 3.11 formats are still usable in 4.0 the new architecture is opt-in, meaning that in order to use the new libraries old formats must indicate to the system that they are compatible (overriding the <code>core_courseformat\base::supports_components</code>).</p><p>The following table compares some of the main changes:</p><table><thead><tr><th>Moodle 3.11</th><th>Moodle 4.0</th></tr></thead><tbody><tr><td>AMD module &quot;core_course/actions&quot; is responsible for capturing the course edition actions, sending them to the correct course webservice, and replacing the returned HTML into the proper page elements.</td><td>Al the functionalities from the original actions are now divided into several AMD modules:<ul><li>core_courseformat/local/courseeditor: coordinates all the UI elements via a data structure called &quot;reactive state data&quot; (or simply, &quot;state data&quot;).</li><li>core_courseformat/local/courseeditor/mutations: centralizes all the backend calls and applies the results to the reactive state data before the UI components update the interface.</li><li>core_courseformat/local/content/actions: captures the user clicks on specific action links and displays modals to get more information from the user if necessary (for example the destination position in a move activity action).</li><li>core_courseformat/content/<!-- -->*<!-- -->: ADM modules responsible for keeping some part of the UI aligned with the reactive state data.</li><li>core_courseformat/courseeditor/<!-- -->*<!-- -->: other modules and helpers</li></ul><p>NOTE: some user actions like hiding and showing sections/activities are not yet migrated to the new architecture.</p><p>NOTE: updating a full section or activity HTML is still handled by the core_course/actions module. However, now both methods are public to the module and they are used by the new course editor.</p></td></tr><tr><td>course/dndupload.js file is responsible for handling any file dropping on the course page.</td><td>Moodle 4.0 still uses the course/dndupload.js to handle files dropped into the course area.</td></tr><tr><td>The webservice core_course_edit_section is responsible for updating a course section and returning the section header and the activities list HTML.</td><td><p>Except for showing and hiding a section (not migrated yet) the rest of the section actions are now handled by the new <code>core_courseformat_update_course</code> webservice.</p><p>The new webservice has the same parameters for both section and activity actions and always returns a standardized data structure to interact with the frontend reactive state data. This means that it does not return HTML fragments anymore.</p></td></tr><tr><td>The webservice core_course_edit_module is responsible for updating activity and returning the activity HTML or other page fragments.</td><td><p>Except for showing and hiding an activity (not migrated yet) the rest of the activity actions are now handled by the new <code>core_courseformat_update_course</code> webservice.</p><p>The new webservice has the same parameters for both section and activity actions and always returns a standardized data structure to interact with the frontend reactive state data. This means that it does not return HTML fragments anymore.</p></td></tr><tr><td>All frontend JS logic is responsible for interacting with the backend and updating all the necessary frontend elements depending on the return value.</td><td><p>The JS logic is now distributed into several modules called &quot;components&quot;. Each module can only interact with a specific page element and watch a data structure called reactive state date (or simply &quot;state data&quot;).</p><p>The main points of the new component structure are:</p><ol><li>The initial state data is loaded using the <code>core_courseformat_get_state</code> webservice</li><li>All components are registered into the core_courseformat/courseeditor page instance.</li><li>When the state data changes, the course editor instance triggers the component&#x27;s watchers methods to update the UI.</li><li>Components are not able to alter the state data. If a component captures an action that requires some state change, it asks the course editor to perform a state mutation.</li></ol></td></tr><tr><td>Formats can alter the page HTML by overriding format_section_renderer_base methods</td><td><p>Most renderer methods are now deprecated and have been migrated to output classes and mustache templates. There are only a few rendered methods formats that can override.</p><p>Now format plugins can override output classes by simply creating the equivalent format_pluginname/output/courseformat/* class. For example, core_courseformat\output\local\content can be overridden by creating a format_pluginname\output\courseformat\content class.</p><p>Important note: the new mustache structure uses partials and blocks to include sub-templates. This opens the door to a future frontend course rendering but it also makes the template overriding a bit more complex. See the &quot;overriding templates&quot; section for more information.</p></td></tr><tr><td><p>Format renderer is optional. If none is provided the course format renderer_base is used.</p><p>Inside a format rendered the <code>$this-&gt;courserenderer</code> attribute is used to access the course renderer methods.</p></td><td>Format renderer is mandatory. The base core_courseformat\output\section_renderer now extends the core_course_renderer class and <code>$this-&gt;courserenderer</code> is deprecated.</td></tr><tr><td>The page elements are located using css class names such as &quot;li.activity&quot;, &quot;.actions&quot;, or &quot;li.section&quot;.</td><td>All page elements are now located using data attributes. See <a href="/devdocs/docs/apis/plugintypes/format#course-elements-data-attributes">Course elements data attributes</a> for more information.</td></tr><tr><td>The course is rendered using print_single_section_page or print_multiple_section_page depending on the number of sections to render.</td><td><p>The course format base instance contains all the necessary data to determine the way a course is rendered. To Specify a single section page formats should use <code>$format-&gt;set_section_number</code> method before rendering the course.</p><p>Once the format instance setup is finished, the course is rendered using the <code>content</code> output class. See migrating old renderer methods to outputs section for more information.</p></td></tr><tr><td>To know if the user is editing the course, the format should check for <code>$PAGE-&gt;user_is_editing()</code> to know if edit is enabled and also <code>has_capability(&#x27;moodle/course:update&#x27;, $coursecontext)</code> to know if the user has the required capabilities.</td><td>The format base class have a method <code>$format-&gt;show_editor()</code> that do all the user and page validations to know if the current course display has to include editor options or not.</td></tr></tbody></table><p>The following diagram represents the data flow of the new architecture:</p><p><img loading="lazy" alt="Course editor workflow" src="/devdocs/assets/images/course_editor_workflow-ed9299531897af09aabc760f3d3a3ae5.png" width="1024" height="768" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="first-steps-to-migrate-a-311-course-format-to-40">First steps to migrate a 3.11 course format to 4.0<a class="hash-link" href="#first-steps-to-migrate-a-311-course-format-to-40" title="Direct link to heading">​</a></h2><p>From 4.0 the course/format folder has its own subsystem called core_courseformat. This subsystem contains all the course rendering logic (only some minor elements are still in the original location for retro compatibility until Moodle 4.3).</p><p>To ensure your format plugin is integrated with the new subsystem:</p><ul><li>The main format_pluginname class should extend <code>core_courseformat\base</code> instead of the old format_base one.</li><li>Your plugin <strong>must provide a renderer class</strong>. In most cases this class <strong>will extend <code>core_courseformat\output\section_renderer</code></strong>.</li><li>Any output class your plugin needs to override should be located in format_pluginname/classes/output/courseformat</li></ul><p>In summary, the first two things you need to adapt to your format are:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="point-1-create-a-renderer-class">Point 1: create a renderer class<a class="hash-link" href="#point-1-create-a-renderer-class" title="Direct link to heading">​</a></h3><p>Now renderer classes are mandatory for course format plugins. Here there are two scenarios:</p><p>Scenario 1: if you plugin already has one you should replace the old &quot;extends format_section_renderer_base&quot; by &quot;extends core_courseformat\output\section_renderer&quot;.</p><p>Scenario 2: If your plugin does not have a renderer, create a file <strong>course/format/pluginname/classes/output/renderer.php</strong> with a content like:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>View example</summary><div><div class="collapsibleContent_i85q"><div><div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">course/format/pluginname/output/renderer.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// This file is part of Moodle - http://moodle.org/</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is free software: you can redistribute it and/or modify</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// it under the terms of the GNU General Public License as published by</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// the Free Software Foundation, either version 3 of the License, or</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// (at your option) any later version.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is distributed in the hope that it will be useful,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// GNU General Public License for more details.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// You should have received a copy of the GNU General Public License</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * Output renderer for the format_pluginname plugin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @package   format_pluginname</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @copyright Year, You Name &lt;your@email.address&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">format_pluginname</span><span class="token php language-php package punctuation" style="color:#393A34">\</span><span class="token php language-php package">output</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">use</span><span class="token php language-php"> </span><span class="token php language-php package">core_courseformat</span><span class="token php language-php package punctuation" style="color:#393A34">\</span><span class="token php language-php package">output</span><span class="token php language-php package punctuation" style="color:#393A34">\</span><span class="token php language-php package">section_renderer</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">use</span><span class="token php language-php"> </span><span class="token php language-php package">moodle_page</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name">renderer</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name">section_renderer</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Your renderer methods goes here.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="point-2-fix-your-base-class">Point 2: fix your base class<a class="hash-link" href="#point-2-fix-your-base-class" title="Direct link to heading">​</a></h3><p>All Moodle 3.11 formats have a base format class extending format_base class from core_course. In Moodle 4.0 this class has been moved to <code>core_courseformat\base</code>. This means that you should replace the existing extends to avoid the deprecation message.</p><p>For compatibility reasons, the base class does not use a namespace and should be located in your plugin &quot;lib.php&quot; file. This could change after Moodle 4.3 when most old course rendering methods will be removed from core.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-new-output-architecture">The new output architecture<a class="hash-link" href="#the-new-output-architecture" title="Direct link to heading">​</a></h2><p>When the debug messages are enabled, all 3.11 format plugins will show several deprecation messages. Most of them are due to the fact that almost all previous renderer methods are now deprecated. The full list can be found in the <strong>course/upgrade.txt</strong> file.</p><p>Until 3.11 all course page elements are rendered using html_writer inside renderer methods. This made the UI hard to maintain because most of the methods are referring to the standard course structure (section_right_content, section_left_content, start_section_list, end_section_list…) instead of generic concepts like sections, activities, or activity menu.</p><p>With the new architecture, almost all UI elements are rendered using:</p><ul><li>An <strong>output class</strong> that generates the data to render. For example, course/format/classes/output/local/content/section.php</li><li>A <strong>mustache template</strong> to render output class data. For example, course/format/templates/local/content/section.mustache</li><li>An optional <strong>reactive component</strong> to update the frontend when the reactive state data changes: For example, course/format/amd/src/local/content/section.js</li></ul><p>The following diagram represents the new output structure compared to the 3.11 one:</p><p><img loading="lazy" alt="Output classes structure" src="/devdocs/assets/images/course_format_output-cc6218fac14403f9fcffdcb1eef001ec.png" width="1964" height="1427" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-old-renderer-methods-to-outputs">Migrating old renderer methods to outputs<a class="hash-link" href="#migrating-old-renderer-methods-to-outputs" title="Direct link to heading">​</a></h2><p>The process of migrating a renderer method to output can be complex depending on the element your format overrides. For these reasons, Moodle 3.11 formats will remain using the old renderer methods until they explicitly use the new outputs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-start-using-output-components-and-renderers">Step 1: start using output components and renderers<a class="hash-link" href="#step-1-start-using-output-components-and-renderers" title="Direct link to heading">​</a></h3><p>As in Moodle 3.11 formats, all the course view is initialized and rendered in the &quot;course/format/pluginname/format.php&quot; file. However, the way the outputs are initialized is quite different from the previous version.</p><p>In Moodle 3.11 the format.php process was something like:</p><ol><li>Do some param validations</li><li>Get the course format instance using <code>course_get_format</code> or <code>core_courseformat\base::instance</code></li><li>Get the format/course renderer using: <code>$PAGE-&gt;get_renderer(&#x27;format_pluginname&#x27;)</code>;</li><li>Use the renderer <code>print_single_section_page</code> or <code>print_multiple_section_page</code> depending on the section param.</li></ol><p>The problems with that approach were:</p><ul><li>There are two main renderer methods which are almost the same</li><li>The auxiliary renderer methods require a big amount of params even if they are not needed for the method because they need to provide those parameters to all the child methods.</li></ul><p>To avoid this situation now the format base class instance is used as a single exchange param to all output classes. Once the format instance is initialized every output class can get all necessary information from it.</p><p>The new workflow in 4.0 is:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>View example</summary><div><div class="collapsibleContent_i85q"><div><div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">course/format/pluginname/format.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// This file is part of Moodle - http://moodle.org/</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is free software: you can redistribute it and/or modify</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// it under the terms of the GNU General Public License as published by</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// the Free Software Foundation, either version 3 of the License, or</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// (at your option) any later version.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is distributed in the hope that it will be useful,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// GNU General Public License for more details.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// You should have received a copy of the GNU General Public License</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * Format course display for the format_pluginname plugin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @package   format_pluginname</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @copyright Year, You Name &lt;your@email.address&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php function" style="color:#d73a49">defined</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php string single-quoted-string" style="color:#e3116c">&#x27;MOODLE_INTERNAL&#x27;</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">||</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">die</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">require_once</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$CFG</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php property" style="color:#36acaa">libdir</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#e3116c">&#x27;/filelib.php&#x27;</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">require_once</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$CFG</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php property" style="color:#36acaa">libdir</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">.</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#e3116c">&#x27;/completionlib.php&#x27;</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Retrieve course format option fields and add them to the $course object.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$format</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">=</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified static-context">core_courseformat</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#393A34">\</span><span class="token php language-php class-name class-name-fully-qualified static-context">base</span><span class="token php language-php operator" style="color:#393A34">::</span><span class="token php language-php function" style="color:#d73a49">instance</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$course</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$course</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#36acaa">$format</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php function" style="color:#d73a49">get_course</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$context</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context">context_course</span><span class="token php language-php operator" style="color:#393A34">::</span><span class="token php language-php function" style="color:#d73a49">instance</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$course</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php property" style="color:#36acaa">id</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Add any extra logic here.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Make sure section 0 is created.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php function" style="color:#d73a49">course_create_sections_if_missing</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$course</span><span class="token php language-php punctuation" style="color:#393A34">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#36acaa">0</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$renderer</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#36acaa">$format</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php function" style="color:#d73a49">get_renderer</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$PAGE</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Setup the format base instance.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php operator" style="color:#393A34">!</span><span class="token php language-php keyword" style="color:#00009f">empty</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$displaysection</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$format</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php function" style="color:#d73a49">set_section_number</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$displaysection</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#393A34">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Output course content.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$outputclass</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#36acaa">$format</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php function" style="color:#d73a49">get_output_classname</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php string single-quoted-string" style="color:#e3116c">&#x27;content&#x27;</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php variable" style="color:#36acaa">$widget</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#393A34">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">new</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#36acaa">$outputclass</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$format</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">echo</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#36acaa">$renderer</span><span class="token php language-php operator" style="color:#393A34">-&gt;</span><span class="token php language-php function" style="color:#d73a49">render</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php variable" style="color:#36acaa">$widget</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Include any format js module here using $PAGE-&gt;requires-&gt;js.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></details><p>Some important notes about the code:</p><ul><li>The rendered class now can be obtained using <code>$format-&gt;get_renderer</code></li><li>Format plugins can override any core_courseformat output class (see sections below for more details). To get the correct output you need to use <code>$format-&gt;get_output_classname</code> method.</li><li>As you may notice, the output class is rendered directly using the render method, not the <code>render_from_template</code> one. This is possible because all output classes implement the new Moodle 4.0 <code>named_templatable</code> interface.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-override-any-output-class-to-alter-the-template-data-to-your-plugin-needs">Step 2: override any output class to alter the template data to your plugin needs<a class="hash-link" href="#step-2-override-any-output-class-to-alter-the-template-data-to-your-plugin-needs" title="Direct link to heading">​</a></h3><p>Instead of having several renderer methods on a single file, the core_courseformat subsystem splits the output logic through several small classes, each one for a specific UI component. Format plugins can easily override specific classes to alter the template data.</p><p>The course format base class has a special method called get_output_classname that returns the overridden class name if available in the format plugin, or the core one if not. In order to detect the format classes, your plugin must place the overridden one in your format_pluginname\output\courseformat<!-- -->.<!-- -->..</p><p>For example, if a format plugin wants to add new options to the section action menu it should override the core_courseformat\output\local\content\section\controlmenu. To do so the plugin class should be format_topics\output\courseformat\content\section\controlmenu. You can find an example of an overridden output in the &quot;course/format/topics/classes/output/courseformat/content/section/controlmenu.php&quot; file.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-create-the-basic-mustache-structure">Step 3: create the basic mustache structure<a class="hash-link" href="#step-3-create-the-basic-mustache-structure" title="Direct link to heading">​</a></h3><p>Unlike output classes, mustache files cannot be extended nor overridden. To be able to alter specific mustaches your plugin must provide a minimum template structure. Furthermore, your plugin must provide some overridden output classes providing the alternative mustache templates location.</p><p>In moodle 3.11 the course render uses html_writer to generate the course view, where each renderer method has both data collection and HTML generating inside. This is not the case in Moodle 4.0. From now on, the full output data is collected via output classes before rendering all the nested mustache templates.</p><p>The course format subsystem requires a minimum of 3 mustaches to render a course:</p><ul><li><strong>local/content</strong>: the full course template</li><li><strong>local/content/section</strong>: a section template. Used to refresh a section via ajax</li><li><strong>local/content/section/cmitem</strong>: an activity item template: Used to refresh an activity via ajax</li></ul><p>The first thing your plugin needs is to create that structure and link it to the output components. Follow the guide on the <a href="/devdocs/docs/apis/plugintypes/format#creating-the-basic-output-structure">create format plugin page</a> to know how to create the basic structure.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-create-your-own-custom-mustache-blocks">Step 4: create your own custom mustache blocks<a class="hash-link" href="#step-4-create-your-own-custom-mustache-blocks" title="Direct link to heading">​</a></h3><p>Once your plugin has the basic mustache structure, you can provide extra mustache blocks to override parts of the page. Follow the <a href="/devdocs/docs/apis/plugintypes/format#override-mustache-blocks">Override mustache blocks</a> on the Creating a course format page to know how to do it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-course-index-in-your-format">Enabling course index in your format<a class="hash-link" href="#enabling-course-index-in-your-format" title="Direct link to heading">​</a></h2><p>If your course format plugin uses a sections-activity structure it is possible to enable the course index. Add the course index in your format is as easy as overriding a method on your format base class:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>View example</summary><div><div class="collapsibleContent_i85q"><div><div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">course/format/pluginname/lib.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// This file is part of Moodle - http://moodle.org/</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is free software: you can redistribute it and/or modify</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// it under the terms of the GNU General Public License as published by</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// the Free Software Foundation, either version 3 of the License, or</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// (at your option) any later version.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is distributed in the hope that it will be useful,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// GNU General Public License for more details.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// You should have received a copy of the GNU General Public License</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * Format base class with course index enabled for the format_pluginname plugin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @package   format_pluginname</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @copyright Year, You Name &lt;your@email.address&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name">format_PLUGINNAME</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified">core_courseformat</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#393A34">\</span><span class="token php language-php class-name class-name-fully-qualified">base</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999988;font-style:italic">// More methods can be added here.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#00009f">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#d73a49">uses_course_index</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#00009f">return</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:#36acaa">true</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#393A34">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></details><p>It is important to note that the course index drawer is only available in Boost based themes, Classic based themes won&#x27;t display it.</p><p>See the course index section in the create format plugin page for more information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-reactive-components">Enabling reactive components<a class="hash-link" href="#enabling-reactive-components" title="Direct link to heading">​</a></h2><p>Moodle 4.0 introduced a new reactive course editor for the frontend. However, the new modules are not compatible with the previous YUI ones. To prevent errors in the 3.11 formats the new libraries are opt-in, meaning plugins must adapt their code before using it.</p><p>Step 1: add data attributes to the HTML elements
The previous YUI editor uses CSS classes to identify sections, activities, and section headers. Nowadays, the use of CSS classes beyond styling is discouraged so the new library uses data attributes to identify the main course page elements.</p><p>To adapt your plugin to the new editor you must add the proper data attributes. The following table explains the new selectors:</p><table><thead><tr><th>Concept</th><th>3.11 equivalent</th><th>4.0 data attributes</th></tr></thead><tbody><tr><td>Section</td><td><code>li.section#section-{SECTION.NUM}</code></td><td><code>data-for=&quot;section&quot;</code><br><code>data-id={SECTION.ID}</code><br><code>data-number={SECTION.NUM}</code></td></tr><tr><td>Section header</td><td><code>#sectionid-{SECTION.ID}-title</code></td><td><code>data-for=&quot;section_title&quot;</code><br><code>data-id={SECTION.ID}</code><br><code>data-number={SECTION.NUM}</code></td></tr><tr><td>Course module item (activity)</td><td><code>li.activity#module-{CM.ID}</code></td><td><code>data-for=&quot;cmitem&quot;</code><br><code>data-id={CM.ID}</code></td></tr><tr><td>Course sections list</td><td><code>.course-content&gt;ul</code></td><td><code>data-for=&quot;course_sectionlist&quot;</code><br></td></tr><tr><td>Course module action link</td><td><code>a.cm-edit-action</code></td><td><code>data-action={ACTIONNAME}</code><br><code>data-id={CM.ID}</code></td></tr><tr><td>Section action link</td><td><code>.section_action_menu</code></td><td><code>data-action={ACTIONNAME}</code><br><code>data-id={SECTION.ID}</code></td></tr><tr><td>Section info</td><td><code>.section_availability</code></td><td><code>data-for=&quot;sectioninfo&quot;</code></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-enable-supports-components-feature">Step 2: enable supports components feature<a class="hash-link" href="#step-2-enable-supports-components-feature" title="Direct link to heading">​</a></h3><p>Once your plugin has all the necessary data attributes you can disable the old YUI editor and enable the new reactive one by adding this method to your plugin base class:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>View example</summary><div><div class="collapsibleContent_i85q"><div><div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">course/format/pluginname/lib.php</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token php language-php delimiter important">&lt;?php</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// This file is part of Moodle - http://moodle.org/</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is free software: you can redistribute it and/or modify</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// it under the terms of the GNU General Public License as published by</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// the Free Software Foundation, either version 3 of the License, or</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// (at your option) any later version.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// Moodle is distributed in the hope that it will be useful,</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// GNU General Public License for more details.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">//</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// You should have received a copy of the GNU General Public License</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * Format base class with components enabled for the format_pluginname plugin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @package   format_pluginname</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @copyright Year, You Name &lt;your@email.address&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php comment" style="color:#999988;font-style:italic"> */</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#00009f">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name">format_PLUGINNAME</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified">core_courseformat</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#393A34">\</span><span class="token php language-php class-name class-name-fully-qualified">base</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999988;font-style:italic">// More methods can be added here.</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#00009f">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#00009f">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#d73a49">supports_components</span><span class="token php language-php punctuation" style="color:#393A34">(</span><span class="token php language-php punctuation" style="color:#393A34">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#393A34">{</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#00009f">return</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:#36acaa">true</span><span class="token php language-php punctuation" style="color:#393A34">;</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#393A34">}</span><span class="token php language-php"></span><br></span><span class="token-line" style="color:#393A34"><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-check-the-reactive-components-are-enabled">Step 3: check the reactive components are enabled.<a class="hash-link" href="#step-3-check-the-reactive-components-are-enabled" title="Direct link to heading">​</a></h3><p>In principle, if you create the basic mustache structure as described in the previous chapter the course editor should work as expected. However, to check if they are working properly:</p><ol><li>Enable developer debug level on your site and access a course as an administrator</li><li>Wait for the page to load and find in the debug footer the &quot;Reactive instances&quot; section.</li><li>Click on the button &quot;CourseEditorXXXX&quot; (where XXXX is the current course ID)</li><li>Once the panel opens, click on the &quot;Highlight OFF&quot; button (it will change to &quot;Highlight ON&quot;)</li><li>Go to the top of the page and check the course content has several thick blue borders.</li></ol><p>If the border appears around all the course content elements (sections, section headers and activities) means that the course editor has registered all the course content as a reactive component.</p><p>If you don&#x27;t have a &quot;CourseEditorXXXX&quot; button or the content elements don&#x27;t get highlighted means that, most probably, you override the main content mustache in a peculiar way and removed the JS initialization.</p><p>To re-introduce the JS initialization you should edit the plugin&#x27;s &quot;content.mustache&quot; file with the following:</p><ul><li>Add <code>id=&quot;{{uniqid}}-course-format&quot;</code> to the course content div element.</li><li>At the end of the template add:</li></ul><div class="language-handlebars codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-handlebars codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">{{</span><span class="token handlebars language-handlebars block keyword" style="color:#00009f">#js</span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">}}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require([&#x27;core_courseformat/local/content&#x27;], function(component) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    component.init(&#x27;</span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">{{</span><span class="token handlebars language-handlebars variable" style="color:#36acaa">uniqid</span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">}}</span><span class="token plain">-course-format&#x27;, {}, </span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">{{</span><span class="token handlebars language-handlebars variable" style="color:#36acaa">sectionreturn</span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">}}</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">{{</span><span class="token handlebars language-handlebars block keyword" style="color:#00009f">/js</span><span class="token handlebars language-handlebars delimiter punctuation" style="color:#393A34">}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By doing that the content main reactive component should be initialized and if you enable the highlighting the content should have a blue border. If some if the inner elements does not have a blue border when highlight is ON means that some data attribute is missing. Check the step 1 of this chapter for more information.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/devdocs/docs/tags/plugins">Plugins</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/devdocs/docs/tags/format">Format</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/moodle/devdocs/edit/main/docs/apis/plugintypes/format/migration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-06-17T11:03:23.000Z">17/06/2022</time></b> by <b>Andrew Lyons</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/devdocs/docs/apis/plugintypes/format"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Course format</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/devdocs/docs/apis/plugintypes/local"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Local plugins</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#changes-summary" class="table-of-contents__link toc-highlight">Changes summary</a></li><li><a href="#moodle-311-vs-40-course-editor-architecture" class="table-of-contents__link toc-highlight">Moodle 3.11 vs 4.0 course editor architecture</a></li><li><a href="#first-steps-to-migrate-a-311-course-format-to-40" class="table-of-contents__link toc-highlight">First steps to migrate a 3.11 course format to 4.0</a><ul><li><a href="#point-1-create-a-renderer-class" class="table-of-contents__link toc-highlight">Point 1: create a renderer class</a></li><li><a href="#point-2-fix-your-base-class" class="table-of-contents__link toc-highlight">Point 2: fix your base class</a></li></ul></li><li><a href="#the-new-output-architecture" class="table-of-contents__link toc-highlight">The new output architecture</a></li><li><a href="#migrating-old-renderer-methods-to-outputs" class="table-of-contents__link toc-highlight">Migrating old renderer methods to outputs</a><ul><li><a href="#step-1-start-using-output-components-and-renderers" class="table-of-contents__link toc-highlight">Step 1: start using output components and renderers</a></li><li><a href="#step-2-override-any-output-class-to-alter-the-template-data-to-your-plugin-needs" class="table-of-contents__link toc-highlight">Step 2: override any output class to alter the template data to your plugin needs</a></li><li><a href="#step-3-create-the-basic-mustache-structure" class="table-of-contents__link toc-highlight">Step 3: create the basic mustache structure</a></li><li><a href="#step-4-create-your-own-custom-mustache-blocks" class="table-of-contents__link toc-highlight">Step 4: create your own custom mustache blocks</a></li></ul></li><li><a href="#enabling-course-index-in-your-format" class="table-of-contents__link toc-highlight">Enabling course index in your format</a></li><li><a href="#enabling-reactive-components" class="table-of-contents__link toc-highlight">Enabling reactive components</a><ul><li><a href="#step-2-enable-supports-components-feature" class="table-of-contents__link toc-highlight">Step 2: enable supports components feature</a></li><li><a href="#step-3-check-the-reactive-components-are-enabled" class="table-of-contents__link toc-highlight">Step 3: check the reactive components are enabled.</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Moodle</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/releases">Release notes</a></li><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/projects">Projects</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/documentation">Developer docs</a></li><li class="footer__item"><a href="https://docs.moodle.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">User docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.moodle.org/dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Legacy docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/devdocs/general/documentation/code-of-conduct">Code of conduct</a></li><li class="footer__item"><a href="https://moodle.org/mod/forum/view.php?id=55" target="_blank" rel="noopener noreferrer" class="footer__link-item">General Developer Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/moodle" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/moodle" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                    <a href="https://www.netlify.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                        <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51">
                    </a>
                    </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
Copyright © 2022 Moodle Pty Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/devdocs/assets/js/runtime~main.108433aa.js"></script>
<script src="/devdocs/assets/js/main.2dbacd86.js"></script>
</body>
</html>